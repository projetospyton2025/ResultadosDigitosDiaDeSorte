
(venv) PS J:\Meu Drive\ProjetosPython\Loterias\Loterias-ResultadosDigitos\ResultadosDigitosDiaDeSorte> dir


    Diret√≥rio: J:\Meu Drive\ProjetosPython\Loterias\Loterias-ResultadosDigitos\ResultadosDigitosDiaDeSorte


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        04/03/2025     13:52                .git
d-----        05/03/2025     06:34                app
d-----        05/03/2025     15:06                venv
d-----        05/03/2025     15:02                templates
d-----        05/03/2025     13:33                static
d-----        05/03/2025     16:11                Requisitos
------        05/03/2025     12:00             27 README.md
------        05/03/2025     12:00           1096 LICENSE
------        05/03/2025     16:27           1648 app.py
------        05/03/2025     16:25           1651 run.py
------        05/03/2025     16:23             68 app.log
------        05/03/2025     15:41            110 requirements.txt
------        27/02/2025     05:43            221 .gitignore
------        05/03/2025     15:45            182 .env


(venv) PS J:\Meu Drive\ProjetosPython\Loterias\Loterias-ResultadosDigitos\ResultadosDigitosDiaDeSorte>

API_BASE_URL=https://loteriascaixa-api.herokuapp.com/api
REDIS_URL=redis://default:B058xThhTvAbptQa0s25EAGk7A5u473O@redis-13833.c336.samerica-east1-1.gce.redns.redis-cloud.com:13833

# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*.class

# Environment
.env
venv/
env/
ENV/

# Flask
instance/
.webassets-cache

# Redis
dump.rdb

# Logs
*.log

# Outros
.DS_Store


2025-03-05 16:23:12,796 - __main__ - INFO - Iniciando aplica√ß√£o...

import logging
from app import app
from dotenv import load_dotenv, find_dotenv
import redis
import os


# Tenta encontrar e carregar o arquivo .env
dotenv_path = find_dotenv()
if not dotenv_path:
    print("‚ùå ERRO: Arquivo .env n√£o encontrado!")
else:
    print(f"‚úÖ Arquivo .env encontrado: {dotenv_path}")
    #load_dotenv(dotenv_path)
    load_dotenv()

# Pegando a URL do Redis
REDIS_URL = os.getenv("REDIS_URL")

print(f"üîç REDIS_URL: {REDIS_URL}")  # Deve exibir a URL do Redis, n√£o None!

if not REDIS_URL:
    print("‚ùå ERRO: REDIS_URL n√£o foi carregada! Verifique o .env ou defina manualmente.")
    exit(1)  # Encerra o programa se a vari√°vel n√£o foi carregada corretamente

try:
    # Criando a conex√£o com o Redis
    redis_client = redis.Redis.from_url(REDIS_URL, decode_responses=True)
    
    # Testando a conex√£o
    redis_client.ping()
    print("‚úÖ Conex√£o com o Redis estabelecida com sucesso!")

except Exception as e:
    print(f"‚ùå Erro ao conectar ao Redis: {type(e).__name__} - {e}")


# Configurar logging
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),
        logging.FileHandler('app.log')
    ]
)

logger = logging.getLogger(__name__)

"""
if __name__ == '__main__':
    logger.info("Iniciando aplica√ß√£o...")
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port, debug=True)
  
"""


if __name__ == '__main__':
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)
	
	Flask==2.3.3
Flask-Cors==4.0.0
redis==5.0.1
python-dotenv==1.0.0
requests==2.31.0
gunicorn==21.2.0


import logging
from app import app
from dotenv import load_dotenv, find_dotenv
import redis
import os


# Tenta encontrar e carregar o arquivo .env
dotenv_path = find_dotenv()
if not dotenv_path:
    print("‚ùå ERRO: Arquivo .env n√£o encontrado!")
else:
    print(f"‚úÖ Arquivo .env encontrado: {dotenv_path}")
    #load_dotenv(dotenv_path)
    load_dotenv()

# Pegando a URL do Redis
REDIS_URL = os.getenv("REDIS_URL")

print(f"üîç REDIS_URL: {REDIS_URL}")  # Deve exibir a URL do Redis, n√£o None!

if not REDIS_URL:
    print("‚ùå ERRO: REDIS_URL n√£o foi carregada! Verifique o .env ou defina manualmente.")
    exit(1)  # Encerra o programa se a vari√°vel n√£o foi carregada corretamente

try:
    # Criando a conex√£o com o Redis
    redis_client = redis.Redis.from_url(REDIS_URL, decode_responses=True)
    
    # Testando a conex√£o
    redis_client.ping()
    print("‚úÖ Conex√£o com o Redis estabelecida com sucesso!")

except Exception as e:
    print(f"‚ùå Erro ao conectar ao Redis: {type(e).__name__} - {e}")


# Configurar logging
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),
        logging.FileHandler('app.log')
    ]
)

logger = logging.getLogger(__name__)

"""
if __name__ == '__main__':
    logger.info("Iniciando aplica√ß√£o...")
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port, debug=True)
  
"""


if __name__ == '__main__':
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)


<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≠gitos Dia de Sorte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
	  <link rel="stylesheet" href="{{ url_for('static', filename='css/popup-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabelas-responsivas.css') }}">
</head>
<body>
    <div class="container">
        <h1>An√°lise de D√≠gitos do <span class="destaque">Dia de Sorte</span></h1>
        
        <div class="centralizado">
            <p>An√°lise dos d√≠gitos de todos os sorteios do Dia de Sorte</p>
        </div>

        <div class="actions">
            <button class="button" id="loadButton">Carregar Resultados</button>
        </div>

        <div id="loadingMessage" class="loading" style="display: none;">Carregando resultados...</div>
        <div id="completedMessage" class="completed" style="display: none;">Carregamento conclu√≠do!</div>

        <!-- Nova se√ß√£o de filtros -->
        <div id="filterContainer" class="filter-container">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Estat√≠sticas de D√≠gitos -->
        <div class="statistics-container">
            <h2>Estat√≠sticas de D√≠gitos</h2>
            <div id="digitStats" class="digit-stats">
                <div class="digit-frequency">
                    <h3>Frequ√™ncia de D√≠gitos</h3>
                    <div id="digitFrequency"></div>
                </div>
                <div class="digit-charts">
                    <h3>Gr√°fico de Frequ√™ncia</h3>
                    <div id="digitChart"></div>
                </div>
            </div>
        </div>

        <!-- Nova se√ß√£o de an√°lise de combina√ß√µes -->
        <div id="combinationAnalysis" class="combination-analysis">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Tabela de Resultados -->
        <h2>Resultados Detalhados</h2>
        <table id="diaDeSorteResults">
            <thead>
                <tr>
                    <th>Concurso</th>
                    <th>Data</th>
                    <th>Dezenas</th>
                    <th>D√≠gitos</th>
                    <th>D√≠gitos Ordenados</th>
                    <th>Qtd. D√≠gitos</th>
                    <th>Copiar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!-- Bot√µes de Download -->
        <div class="download-buttons">
            <button class="button" id="downloadCSV">Baixar XLS</button>
            <button class="button" id="downloadJSON">Baixar HTML</button>
            <button class="button" id="downloadTXT">Baixar TXT</button>
        </div>
    </div>

    <footer>Feito por: <i>M√°rcio Fernando Maia - Todos os direitos reservados - 2025</i></footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/highlight-max.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/frequency-analysis.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/popup-explicacao.js') }}"></script>
    <script src="{{ url_for('static', filename='js/resumo-simples.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabelas-responsivas.js') }}"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≠gitos Dia de Sorte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
	  <link rel="stylesheet" href="{{ url_for('static', filename='css/popup-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabelas-responsivas.css') }}">
</head>
<body>
    <div class="container">
        <h1>An√°lise de D√≠gitos do <span class="destaque">Dia de Sorte</span></h1>
        
        <div class="centralizado">
            <p>An√°lise dos d√≠gitos de todos os sorteios do Dia de Sorte</p>
        </div>

        <div class="actions">
            <button class="button" id="loadButton">Carregar Resultados</button>
        </div>

        <div id="loadingMessage" class="loading" style="display: none;">Carregando resultados...</div>
        <div id="completedMessage" class="completed" style="display: none;">Carregamento conclu√≠do!</div>

        <!-- Nova se√ß√£o de filtros -->
        <div id="filterContainer" class="filter-container">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Estat√≠sticas de D√≠gitos -->
        <div class="statistics-container">
            <h2>Estat√≠sticas de D√≠gitos</h2>
            <div id="digitStats" class="digit-stats">
                <div class="digit-frequency">
                    <h3>Frequ√™ncia de D√≠gitos</h3>
                    <div id="digitFrequency"></div>
                </div>
                <div class="digit-charts">
                    <h3>Gr√°fico de Frequ√™ncia</h3>
                    <div id="digitChart"></div>
                </div>
            </div>
        </div>

        <!-- Nova se√ß√£o de an√°lise de combina√ß√µes -->
        <div id="combinationAnalysis" class="combination-analysis">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Tabela de Resultados -->
        <h2>Resultados Detalhados</h2>
        <table id="diaDeSorteResults">
            <thead>
                <tr>
                    <th>Concurso</th>
                    <th>Data</th>
                    <th>Dezenas</th>
                    <th>D√≠gitos</th>
                    <th>D√≠gitos Ordenados</th>
                    <th>Qtd. D√≠gitos</th>
                    <th>Copiar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!-- Bot√µes de Download -->
        <div class="download-buttons">
            <button class="button" id="downloadCSV">Baixar XLS</button>
            <button class="button" id="downloadJSON">Baixar HTML</button>
            <button class="button" id="downloadTXT">Baixar TXT</button>
        </div>
    </div>

    <footer>Feito por: <i>M√°rcio Fernando Maia - Todos os direitos reservados - 2025</i></footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/highlight-max.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/frequency-analysis.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/popup-explicacao.js') }}"></script>
    <script src="{{ url_for('static', filename='js/resumo-simples.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabelas-responsivas.js') }}"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≠gitos Dia de Sorte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
	  <link rel="stylesheet" href="{{ url_for('static', filename='css/popup-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabelas-responsivas.css') }}">
</head>
<body>
    <div class="container">
        <h1>An√°lise de D√≠gitos do <span class="destaque">Dia de Sorte</span></h1>
        
        <div class="centralizado">
            <p>An√°lise dos d√≠gitos de todos os sorteios do Dia de Sorte</p>
        </div>

        <div class="actions">
            <button class="button" id="loadButton">Carregar Resultados</button>
        </div>

        <div id="loadingMessage" class="loading" style="display: none;">Carregando resultados...</div>
        <div id="completedMessage" class="completed" style="display: none;">Carregamento conclu√≠do!</div>

        <!-- Nova se√ß√£o de filtros -->
        <div id="filterContainer" class="filter-container">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Estat√≠sticas de D√≠gitos -->
        <div class="statistics-container">
            <h2>Estat√≠sticas de D√≠gitos</h2>
            <div id="digitStats" class="digit-stats">
                <div class="digit-frequency">
                    <h3>Frequ√™ncia de D√≠gitos</h3>
                    <div id="digitFrequency"></div>
                </div>
                <div class="digit-charts">
                    <h3>Gr√°fico de Frequ√™ncia</h3>
                    <div id="digitChart"></div>
                </div>
            </div>
        </div>

        <!-- Nova se√ß√£o de an√°lise de combina√ß√µes -->
        <div id="combinationAnalysis" class="combination-analysis">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Tabela de Resultados -->
        <h2>Resultados Detalhados</h2>
        <table id="diaDeSorteResults">
            <thead>
                <tr>
                    <th>Concurso</th>
                    <th>Data</th>
                    <th>Dezenas</th>
                    <th>D√≠gitos</th>
                    <th>D√≠gitos Ordenados</th>
                    <th>Qtd. D√≠gitos</th>
                    <th>Copiar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!-- Bot√µes de Download -->
        <div class="download-buttons">
            <button class="button" id="downloadCSV">Baixar XLS</button>
            <button class="button" id="downloadJSON">Baixar HTML</button>
            <button class="button" id="downloadTXT">Baixar TXT</button>
        </div>
    </div>

    <footer>Feito por: <i>M√°rcio Fernando Maia - Todos os direitos reservados - 2025</i></footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/highlight-max.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/frequency-analysis.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/popup-explicacao.js') }}"></script>
    <script src="{{ url_for('static', filename='js/resumo-simples.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabelas-responsivas.js') }}"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≠gitos Dia de Sorte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
	  <link rel="stylesheet" href="{{ url_for('static', filename='css/popup-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabelas-responsivas.css') }}">
</head>
<body>
    <div class="container">
        <h1>An√°lise de D√≠gitos do <span class="destaque">Dia de Sorte</span></h1>
        
        <div class="centralizado">
            <p>An√°lise dos d√≠gitos de todos os sorteios do Dia de Sorte</p>
        </div>

        <div class="actions">
            <button class="button" id="loadButton">Carregar Resultados</button>
        </div>

        <div id="loadingMessage" class="loading" style="display: none;">Carregando resultados...</div>
        <div id="completedMessage" class="completed" style="display: none;">Carregamento conclu√≠do!</div>

        <!-- Nova se√ß√£o de filtros -->
        <div id="filterContainer" class="filter-container">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Estat√≠sticas de D√≠gitos -->
        <div class="statistics-container">
            <h2>Estat√≠sticas de D√≠gitos</h2>
            <div id="digitStats" class="digit-stats">
                <div class="digit-frequency">
                    <h3>Frequ√™ncia de D√≠gitos</h3>
                    <div id="digitFrequency"></div>
                </div>
                <div class="digit-charts">
                    <h3>Gr√°fico de Frequ√™ncia</h3>
                    <div id="digitChart"></div>
                </div>
            </div>
        </div>

        <!-- Nova se√ß√£o de an√°lise de combina√ß√µes -->
        <div id="combinationAnalysis" class="combination-analysis">
            <!-- Ser√° preenchido via JavaScript -->
        </div>

        <!-- Tabela de Resultados -->
        <h2>Resultados Detalhados</h2>
        <table id="diaDeSorteResults">
            <thead>
                <tr>
                    <th>Concurso</th>
                    <th>Data</th>
                    <th>Dezenas</th>
                    <th>D√≠gitos</th>
                    <th>D√≠gitos Ordenados</th>
                    <th>Qtd. D√≠gitos</th>
                    <th>Copiar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!-- Bot√µes de Download -->
        <div class="download-buttons">
            <button class="button" id="downloadCSV">Baixar XLS</button>
            <button class="button" id="downloadJSON">Baixar HTML</button>
            <button class="button" id="downloadTXT">Baixar TXT</button>
        </div>
    </div>

    <footer>Feito por: <i>M√°rcio Fernando Maia - Todos os direitos reservados - 2025</i></footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/highlight-max.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/frequency-analysis.js') }}"></script>
	  <script src="{{ url_for('static', filename='js/popup-explicacao.js') }}"></script>
    <script src="{{ url_for('static', filename='js/resumo-simples.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabelas-responsivas.js') }}"></script>
</body>
</html>

// Solu√ß√£o simplificada para adicionar bot√£o e gerar resumo

// Adicionar o bot√£o quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
    console.log("Script de resumo simplificado carregado");
    
    // Fun√ß√£o que adiciona o bot√£o
    function adicionarBotao() {
        // Verificar se o bot√£o j√° existe
        if (document.getElementById('botaoAnalisarFrequencias')) {
            return;
        }
        
        // Criar o bot√£o
        const botao = document.createElement('button');
        botao.id = 'botaoAnalisarFrequencias';
        botao.className = 'button';
        botao.textContent = 'Resumo';
        
        // Adicionar evento de clique
        botao.addEventListener('click', function() {
            console.log("Bot√£o clicado - gerando resumo");
            gerarResumo();
        });
        
        // Encontrar um local para adicionar o bot√£o
        const actionsContainer = document.querySelector('.actions');
        if (actionsContainer) {
            actionsContainer.appendChild(botao);
            console.log("Bot√£o adicionado √† se√ß√£o .actions");
        } else {
            // Alternativa: adicionar antes da tabela
            const tabela = document.getElementById('diaDeSorteResults');
            if (tabela) {
                const div = document.createElement('div');
                div.className = 'actions';
                div.style.textAlign = 'center';
                div.style.margin = '20px 0';
                div.appendChild(botao);
                
                tabela.parentNode.insertBefore(div, tabela);
                console.log("Bot√£o adicionado antes da tabela");
            } else {
                console.log("N√£o foi poss√≠vel encontrar um local para o bot√£o");
            }
        }
    }
    
    // Adicionar o bot√£o ap√≥s um tempo para garantir que a p√°gina carregou
    setTimeout(adicionarBotao, 1000);
    
    // Tentar adicionar novamente quando a mensagem de carregamento completado aparecer
    const verificarCarregamento = setInterval(function() {
        const mensagemCompletada = document.getElementById('completedMessage');
        if (mensagemCompletada && getComputedStyle(mensagemCompletada).display !== 'none') {
            console.log("Carregamento completado detectado");
            adicionarBotao();
            clearInterval(verificarCarregamento);
        }
    }, 1000);
    
    // Limitar a verifica√ß√£o a 20 segundos
    setTimeout(function() {
        clearInterval(verificarCarregamento);
    }, 20000);
});

// Fun√ß√£o para gerar o resumo
function gerarResumo() {
    console.log("In√≠cio da gera√ß√£o do resumo");
    
    // Remover resumo anterior, se existir
    const resumoAnterior = document.getElementById('resumo');
    if (resumoAnterior) {
        resumoAnterior.remove();
        console.log("Resumo anterior removido");
    }
    
    // Criar o resumo
    const resumo = document.createElement('div');
    resumo.id = 'resumo';
    resumo.style.margin = '30px 0';
    resumo.style.padding = '20px';
    resumo.style.backgroundColor = '#f9f9f9';
    resumo.style.borderRadius = '8px';
    resumo.style.border = '2px solid #673AB7';
    resumo.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
    
    // Valores padr√£o atualizados com base na tabela fornecida
    let combinacao = '0,1,2,3,5,7,9';
    let frequencia = 22;
    let intervaloMedio = 41;  // Corrigido de 13 para 41
    let menorIntervalo = 3;   // Corrigido de 1 para 3
    let maiorIntervalo = 121; // Corrigido de 38 para 121
    let ultimoIntervalo = 38; // Corrigido de 13 para 38
    
    // Tentar extrair dados reais da tabela
    try {
        console.log("Tentando extrair dados da tabela de combina√ß√µes");
        const tabelaCombinacoes = document.querySelector('.combinations-table');
        
        if (tabelaCombinacoes) {
            console.log("Tabela de combina√ß√µes encontrada");
            const linhasTabela = tabelaCombinacoes.querySelectorAll('tbody tr');
            
            if (linhasTabela && linhasTabela.length > 0) {
                console.log(`Encontradas ${linhasTabela.length} linhas na tabela`);
                
                // Pegar a primeira linha (combina√ß√£o mais frequente)
                const primeiraLinha = linhasTabela[0];
                const colunas = primeiraLinha.querySelectorAll('td');
                
                console.log(`Colunas na primeira linha: ${colunas.length}`);
                
                if (colunas.length >= 7) {
                    // Extrair valores espec√≠ficos de cada coluna
                    combinacao = colunas[0].textContent.trim();
                    frequencia = parseInt(colunas[2].textContent) || frequencia;
                    intervaloMedio = parseInt(colunas[3].textContent) || intervaloMedio;
                    menorIntervalo = parseInt(colunas[4].textContent) || menorIntervalo;
                    maiorIntervalo = parseInt(colunas[5].textContent) || maiorIntervalo;
                    ultimoIntervalo = parseInt(colunas[6].textContent) || ultimoIntervalo;
                    
                    console.log("Dados extra√≠dos com sucesso da tabela:");
                    console.log(`Combina√ß√£o: ${combinacao}`);
                    console.log(`Frequ√™ncia: ${frequencia}`);
                    console.log(`Intervalo M√©dio: ${intervaloMedio}`);
                    console.log(`Menor Intervalo: ${menorIntervalo}`);
                    console.log(`Maior Intervalo: ${maiorIntervalo}`);
                    console.log(`√öltimo Intervalo: ${ultimoIntervalo}`);
                } else {
                    console.log(`N√∫mero insuficiente de colunas: ${colunas.length}, esperado pelo menos 7`);
                }
            } else {
                console.log("Nenhuma linha encontrada na tabela");
            }
        } else {
            console.log("Tabela de combina√ß√µes n√£o encontrada");
        }
    } catch (e) {
        console.error("Erro ao extrair dados da tabela:", e);
    }
    
    // Conte√∫do do resumo
    resumo.innerHTML = `
    <h2 style="color: rebeccapurple;">RESUMO GERAL</h2>
    <p>A an√°lise dos dados mostra que a combina√ß√£o <strong>${combinacao}</strong> apareceu <strong>${frequencia} vezes</strong> nos concursos do Dia de Sorte, com um intervalo m√©dio de <strong>${intervaloMedio} concursos</strong> entre suas apari√ß√µes. A menor sequ√™ncia entre ocorr√™ncias foi de apenas <strong>${menorIntervalo} concursos</strong>, e a maior chegou a <strong>${maiorIntervalo} concursos</strong>.</p>
    
    <h2 style="color: red;">Estrat√©gia de Aposta Recomendada:</h2>
    
    <ol>
        <li>
            <strong>Acompanhar o Intervalo M√©dio</strong>
            <p>Como a m√©dia entre apari√ß√µes √© de <strong>${intervaloMedio} concursos</strong>, um bom momento para apostar nessa sequ√™ncia seria quando ela j√° estiver sem sair por algo pr√≥ximo a esse n√∫mero de concursos.</p>
        </li>
        <li>
            <strong>Apostar com Maior Frequ√™ncia quando o Intervalo Estiver Pr√≥ximo da M√©dia</strong>
            <p>Se o intervalo entre as apari√ß√µes da sequ√™ncia atingir <strong>${Math.floor(intervaloMedio * 0.8)} a ${Math.ceil(intervaloMedio * 1.2)} concursos</strong>, pode ser um bom indicativo de que ela tem uma boa chance de sair.</p>
        </li>
        <li>
            <strong>Monitorar o √öltimo Intervalo</strong>
            <p>O √∫ltimo intervalo registrado foi de <strong>${ultimoIntervalo} concursos</strong>, o que indica que pode haver uma tend√™ncia de repeti√ß√£o em per√≠odos mais curtos.</p>
        </li>
        <li>
            <strong>Variar os N√∫meros Dentro da Combina√ß√£o</strong>
            <p>Algumas combina√ß√µes semelhantes (ex.: trocando o n√∫mero <strong>9 por 6 ou 8</strong>) tamb√©m aparecem frequentemente. Fazer apostas variando um ou dois n√∫meros pode aumentar as chances.</p>
        </li>
        <li>
            <strong>Evitar Apostar Quando a Sequ√™ncia Saiu Recentemente</strong>
            <p>Se essa sequ√™ncia apareceu nos √∫ltimos <strong>5 a 10 concursos</strong>, a chance de repeti√ß√£o imediata pode ser menor.</p>
        </li>
    </ol>
    
    <h2>Conclus√£o:</h2>
    
    <p>Se a combina√ß√£o <strong>${combinacao}</strong> estiver sem aparecer por <strong>${intervaloMedio} concursos ou mais</strong>, pode valer a pena apostar nela ou em varia√ß√µes pr√≥ximas. Caso tenha sa√≠do recentemente, melhor esperar mais alguns concursos antes de apostar nessa combina√ß√£o novamente.</p>
    
    <p>Esta an√°lise √© baseada em padr√µes hist√≥ricos e n√£o garante resultados futuros. O Dia de Sorte √© um jogo de sorte com resultados aleat√≥rios.</p>
`;

    
    // Adicionar o resumo √† p√°gina
    const botao = document.getElementById('botaoAnalisarFrequencias');
    if (botao) {
        // Adicionar ap√≥s o container do bot√£o
        const container = botao.closest('.actions');
        if (container) {
            container.parentNode.insertBefore(resumo, container.nextSibling);
        } else {
            botao.parentNode.insertBefore(resumo, botao.nextSibling);
        }
    } else {
        // Adicionar antes da tabela se o bot√£o n√£o for encontrado
        const tabela = document.getElementById('diaDeSorteResults');
        if (tabela) {
            tabela.parentNode.insertBefore(resumo, tabela);
        } else {
            // √öltima op√ß√£o: adicionar ao final do container principal
            const container = document.querySelector('.container');
            if (container) {
                container.appendChild(resumo);
            } else {
                console.error("N√£o foi poss√≠vel encontrar um local para inserir o resumo");
                alert("N√£o foi poss√≠vel exibir o resumo. Verifique o console para mais detalhes.");
                return;
            }
        }
    }
    
    // Rolar at√© o resumo
    resumo.scrollIntoView({ behavior: 'smooth' });
    
    console.log("Resumo gerado com sucesso");
}

document.addEventListener('DOMContentLoaded', function() {
    const loadButton = document.getElementById('loadButton');
    const downloadCSVButton = document.getElementById('downloadCSV');
    const downloadJSONButton = document.getElementById('downloadJSON');
    const downloadTXTButton = document.getElementById('downloadTXT');
    
    let allResults = [];
    let filteredResults = [];
    let digitStats = {};
    let combinationStats = {};
    
    // Registrar eventos de clique
    loadButton.addEventListener('click', fetchDigitosResults);
    downloadCSVButton.addEventListener('click', downloadCSV);
    downloadJSONButton.addEventListener('click', downloadJSON);
    downloadTXTButton.addEventListener('click', downloadTXT);
	
	
	// Chamar fetchDigitosResults automaticamente quando a p√°gina carregar
    fetchDigitosResults();
    
    // Fun√ß√£o para buscar os resultados - com tratamento de erros melhorado
    async function fetchDigitosResults() {
		// No in√≠cio da fun√ß√£o fetchDigitosResults
		console.log("Fun√ß√£o fetchDigitosResults iniciada");
		
		const loadButton = document.getElementById('loadButton');

		// Desabilitar o bot√£o enquanto carrega
		if (loadButton) {
			loadButton.disabled = true;
			loadButton.style.opacity = '0.6';
			loadButton.style.cursor = 'not-allowed';
		}
		
        const loadingMessage = document.getElementById('loadingMessage');
        const completedMessage = document.getElementById('completedMessage');
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        const filterContainerDiv = document.getElementById('filterContainer');
        
        loadingMessage.style.display = 'block';
        completedMessage.style.display = 'none';
        tableBody.innerHTML = '';
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        combinationAnalysisDiv.innerHTML = '';
        filterContainerDiv.innerHTML = '';
        
        try {
            console.log("Iniciando fetch de dados...");
            const response = await fetch('/api/digitos');
            console.log("Status da resposta:", response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error("Erro na resposta:", errorText);
                throw new Error(`Erro ao acessar a API. Status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("Dados recebidos:", data);
            
            if (data.resultados && Array.isArray(data.resultados)) {
                allResults = data.resultados;
				// Compartilhar resultados no escopo global
				window.allResults = allResults;
				window.digitStats = digitStats;
				
				
                filteredResults = [...allResults]; // Inicialmente, todos os resultados
                digitStats = data.frequencia_digitos;
                
                // Analisar combina√ß√µes de d√≠gitos
                analisarCombinacoes(allResults);
                
                // Renderizar tudo
                renderFilterOptions();
                renderResults(filteredResults);
                renderDigitStats(digitStats);
                renderCombinationAnalysis();
            } else {
                console.error("Formato inv√°lido:", data);
                throw new Error('Formato de dados inv√°lido.');
            }
        } catch (error) {
            console.error("Erro detalhado:", error);
            alert('Erro ao buscar os resultados: ' + error.message);
        } finally {
            loadingMessage.style.display = 'none';
            completedMessage.style.display = 'block';
			
			// Reabilitar o bot√£o quando o carregamento terminar
			if (loadButton) {
				loadButton.disabled = false;
				loadButton.style.opacity = '1';
				loadButton.style.cursor = 'pointer';
			}
        }
    }
    
    // Fun√ß√£o para analisar combina√ß√µes de d√≠gitos
    function analisarCombinacoes(results) {
        combinationStats = {
            porQuantidade: {}, // Agrupar por quantidade de d√≠gitos
            combinacoesFrequentes: {}, // Combina√ß√µes mais frequentes
            digitosExclusivos: {} // D√≠gitos que aparecem apenas em alguns sorteios
        };
        
        // Agrupar resultados por quantidade de d√≠gitos
        results.forEach(result => {
            const qtd = result.contagem_digitos;
            if (!combinationStats.porQuantidade[qtd]) {
                combinationStats.porQuantidade[qtd] = [];
            }
            combinationStats.porQuantidade[qtd].push(result);
        });
        
        // Encontrar combina√ß√µes frequentes
        results.forEach(result => {
            const combinacao = result.digitos_ordenados.join(',');
            if (!combinationStats.combinacoesFrequentes[combinacao]) {
                combinationStats.combinacoesFrequentes[combinacao] = {
                    combinacao: combinacao,
                    concursos: [],
                    digitos: result.digitos_ordenados,
                    quantidade: result.contagem_digitos
                };
            }
            combinationStats.combinacoesFrequentes[combinacao].concursos.push(result.concurso);
        });
        
        // Ordenar combina√ß√µes por frequ√™ncia
        combinationStats.combinacoesFrequentes = Object.values(combinationStats.combinacoesFrequentes)
            .sort((a, b) => b.concursos.length - a.concursos.length);
        
        // Analisar similaridades e diferen√ßas entre combina√ß√µes
        for (let i = 0; i < combinationStats.combinacoesFrequentes.length; i++) {
            const combo = combinationStats.combinacoesFrequentes[i];
            combo.similares = [];
            
            for (let j = 0; j < combinationStats.combinacoesFrequentes.length; j++) {
                if (i === j) continue;
                
                const outroCombo = combinationStats.combinacoesFrequentes[j];
                
                // Comparar os d√≠gitos
                const digitosCombo = new Set(combo.digitos);
                const digitosOutroCombo = new Set(outroCombo.digitos);
                
                // Diferen√ßas
                const digitosExclusivosCombo1 = [...digitosCombo].filter(d => !digitosOutroCombo.has(d));
                const digitosExclusivosCombo2 = [...digitosOutroCombo].filter(d => !digitosCombo.has(d));
                
                // Interse√ß√£o
                const digitosComuns = [...digitosCombo].filter(d => digitosOutroCombo.has(d));
                
                // Se tem similaridade significativa (mais de 70% em comum)
                if (digitosComuns.length >= combo.digitos.length * 0.7) {
                    combo.similares.push({
                        concursos: outroCombo.concursos,
                        digitosComuns: digitosComuns,
                        digitosDiferentes: {
                            de: digitosExclusivosCombo1,
                            para: digitosExclusivosCombo2
                        }
                    });
                }
            }
            
            // Limitar a 5 combina√ß√µes similares por combina√ß√£o
            combo.similares = combo.similares.slice(0, 5);
        }
        
        // Calcular estat√≠sticas adicionais para as combina√ß√µes frequentes
        combinationStats.combinacoesFrequentes.forEach(combo => {
            // Ordenar concursos
            combo.concursos.sort((a, b) => a - b);
            
            // Calcular intervalos
            const intervalos = [];
            for (let i = 1; i < combo.concursos.length; i++) {
                intervalos.push(combo.concursos[i] - combo.concursos[i-1]);
            }
            
            if (intervalos.length > 0) {
                combo.intervalos = intervalos;
                combo.mediaIntervalos = Math.round(intervalos.reduce((a, b) => a + b, 0) / intervalos.length);
                combo.menorIntervalo = Math.min(...intervalos);
                combo.maiorIntervalo = Math.max(...intervalos);
                combo.ultimoIntervalo = intervalos[intervalos.length - 1];
            }
        });
        
        // Limitar as combina√ß√µes mais frequentes √†s top 10
        combinationStats.combinacoesFrequentes = combinationStats.combinacoesFrequentes.slice(0, 10);
        
        // Compartilhar resultados analisados no escopo global para uso pelo resumo-simples.js
        window.resultadosAnalisados = {
            combinacoesOrdenadas: combinationStats.combinacoesFrequentes,
            mediaGeral: combinationStats.combinacoesFrequentes.reduce((acc, c) => acc + (c.mediaIntervalos || 0), 0) / 
                        combinationStats.combinacoesFrequentes.filter(c => c.mediaIntervalos).length
        };
    }
    
    // Fun√ß√£o para renderizar op√ß√µes de filtro
    function renderFilterOptions() {
        const filterContainerDiv = document.getElementById('filterContainer');
        
        // Clear filter container
        filterContainerDiv.innerHTML = '';
        
        // Criar o t√≠tulo
        const filterTitle = document.createElement('h3');
        filterTitle.textContent = 'Filtros';
        filterContainerDiv.appendChild(filterTitle);
        
        // Criar container de filtros
        const filtersDiv = document.createElement('div');
        filtersDiv.className = 'filters';
        
        // 1. Filtro por quantidade de d√≠gitos
        const qtdDigitosDiv = document.createElement('div');
        qtdDigitosDiv.className = 'filter-item';
        
        const qtdDigitosLabel = document.createElement('label');
        qtdDigitosLabel.textContent = 'Qtd. D√≠gitos: ';
        
        const qtdDigitosSelect = document.createElement('select');
        qtdDigitosSelect.id = 'qtdDigitosFilter';
        
        // Op√ß√£o "Todos"
        const optionTodos = document.createElement('option');
        optionTodos.value = '';
        optionTodos.textContent = 'Todos';
        qtdDigitosSelect.appendChild(optionTodos);
        
        // Quantidades dispon√≠veis
        const quantidades = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        quantidades.forEach(qtd => {
            const option = document.createElement('option');
            option.value = qtd;
            option.textContent = `${qtd} d√≠gitos (${combinationStats.porQuantidade[qtd].length} resultados)`;
            qtdDigitosSelect.appendChild(option);
        });
        
        qtdDigitosDiv.appendChild(qtdDigitosLabel);
        qtdDigitosDiv.appendChild(qtdDigitosSelect);
        
        // 2. Filtro por d√≠gito espec√≠fico
        const digitoEspecificoDiv = document.createElement('div');
        digitoEspecificoDiv.className = 'filter-item';
        
        const digitoEspecificoLabel = document.createElement('label');
        digitoEspecificoLabel.textContent = 'Cont√©m D√≠gito: ';
        
        const digitoEspecificoSelect = document.createElement('select');
        digitoEspecificoSelect.id = 'digitoEspecificoFilter';
        
        // Op√ß√£o "Todos"
        const optionTodosDigitos = document.createElement('option');
        optionTodosDigitos.value = '';
        optionTodosDigitos.textContent = 'Todos';
        digitoEspecificoSelect.appendChild(optionTodosDigitos);
        
        // Listar todos os d√≠gitos ordenados por frequ√™ncia
        const digitosPorFrequencia = Object.entries(digitStats)
            .sort((a, b) => b[1] - a[1]);
        
        digitosPorFrequencia.forEach(([digito, frequencia]) => {
            const option = document.createElement('option');
            option.value = digito;
            option.textContent = `D√≠gito ${digito} (${frequencia} ocorr√™ncias)`;
            digitoEspecificoSelect.appendChild(option);
        });
        
        digitoEspecificoDiv.appendChild(digitoEspecificoLabel);
        digitoEspecificoDiv.appendChild(digitoEspecificoSelect);
        
        // 3. Bot√£o de aplicar filtro
        const aplicarFiltroBtn = document.createElement('button');
        aplicarFiltroBtn.textContent = 'Aplicar Filtros';
        aplicarFiltroBtn.className = 'button';
        aplicarFiltroBtn.onclick = aplicarFiltros;
        
        // 4. Bot√£o de limpar filtro
        const limparFiltroBtn = document.createElement('button');
        limparFiltroBtn.textContent = 'Limpar Filtros';
        limparFiltroBtn.className = 'button';
        limparFiltroBtn.onclick = limparFiltros;
        
        // Adicionar todos os elementos ao container
        filtersDiv.appendChild(qtdDigitosDiv);
        filtersDiv.appendChild(digitoEspecificoDiv);
        filtersDiv.appendChild(aplicarFiltroBtn);
        filtersDiv.appendChild(limparFiltroBtn);
        
        filterContainerDiv.appendChild(filtersDiv);
    }
    
    // Fun√ß√£o para aplicar filtros
    function aplicarFiltros() {
        const qtdDigitosFilter = document.getElementById('qtdDigitosFilter').value;
        const digitoEspecificoFilter = document.getElementById('digitoEspecificoFilter').value;
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        
        // Aplicar filtro de quantidade de d√≠gitos
        if (qtdDigitosFilter) {
            filteredResults = filteredResults.filter(
                result => result.contagem_digitos == parseInt(qtdDigitosFilter)
            );
        }
        
        // Aplicar filtro de d√≠gito espec√≠fico
        if (digitoEspecificoFilter) {
            filteredResults = filteredResults.filter(
                result => result.digitos_ordenados.includes(digitoEspecificoFilter)
            );
        }
        
        // Renderizar resultados filtrados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para limpar filtros
    function limparFiltros() {
        document.getElementById('qtdDigitosFilter').value = '';
        document.getElementById('digitoEspecificoFilter').value = '';
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para renderizar a an√°lise de combina√ß√µes
    function renderCombinationAnalysis() {
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        
        // T√≠tulo da se√ß√£o
        const title = document.createElement('h3');
        title.textContent = 'An√°lise de Combina√ß√µes de D√≠gitos';
        combinationAnalysisDiv.appendChild(title);
        
        // 1. Combina√ß√µes mais frequentes
        const combinacoesFrequentesTitle = document.createElement('h4');
        combinacoesFrequentesTitle.textContent = 'Combina√ß√µes Mais Frequentes';
        combinationAnalysisDiv.appendChild(combinacoesFrequentesTitle);
        
        const combinacoesTable = document.createElement('table');
        combinacoesTable.className = 'combinations-table';
        
		// Cabe√ßalho da tabela
		const headerRow = document.createElement('tr');
		[
			'Combina√ß√£o', 
			'Qtd. D√≠gitos', 
			'Frequ√™ncia', 
			'Detalhes'
		].forEach(text => {
			const th = document.createElement('th');
			th.textContent = text;
			headerRow.appendChild(th);
		});        combinacoesTable.appendChild(headerRow);
        
        // Dados da tabela
        combinationStats.combinacoesFrequentes.forEach(combo => {
            const row = document.createElement('tr');
            
            // Combina√ß√£o
            const tdCombo = document.createElement('td');
            tdCombo.textContent = combo.digitos.join(',');
            row.appendChild(tdCombo);
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = combo.quantidade;
            row.appendChild(tdQtd);
            
            // Frequ√™ncia (n√∫mero de concursos)
            const tdFreq = document.createElement('td');
            tdFreq.textContent = combo.concursos.length;
            row.appendChild(tdFreq);
            
            // Bot√£o para ver detalhes
            const tdDetails = document.createElement('td');
            const detailsBtn = document.createElement('button');
            detailsBtn.textContent = 'Ver Detalhes';
            detailsBtn.className = 'details-button';
            detailsBtn.onclick = () => {
                mostrarDetalhesCombinacao(combo);
            };
            tdDetails.appendChild(detailsBtn);
            row.appendChild(tdDetails);
            
            combinacoesTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(combinacoesTable);
        
        // 2. Resumo por quantidade de d√≠gitos
        const resumoQtdTitle = document.createElement('h4');
        resumoQtdTitle.textContent = 'Resumo por Quantidade de D√≠gitos';
        combinationAnalysisDiv.appendChild(resumoQtdTitle);
        
        const resumoTable = document.createElement('table');
        resumoTable.className = 'summary-table';
        
        // Cabe√ßalho da tabela
        const resumoHeader = document.createElement('tr');
        ['Qtd. D√≠gitos', 'N√∫mero de Sorteios', 'Porcentagem'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            resumoHeader.appendChild(th);
        });
        resumoTable.appendChild(resumoHeader);
        
        // Dados da tabela
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const row = document.createElement('tr');
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = qtd;
            row.appendChild(tdQtd);
            
            // N√∫mero de sorteios
            const count = combinationStats.porQuantidade[qtd].length;
            const tdCount = document.createElement('td');
            tdCount.textContent = count;
            row.appendChild(tdCount);
            
            // Porcentagem
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            const tdPercentage = document.createElement('td');
            tdPercentage.textContent = `${percentage}%`;
            row.appendChild(tdPercentage);
            
            resumoTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(resumoTable);
    }
    
    // Fun√ß√£o para mostrar detalhes de uma combina√ß√£o
    function mostrarDetalhesCombinacao(combo) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        // Fechar modal
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-button';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = () => {
            document.body.removeChild(modal);
        };
        
        // T√≠tulo
        const title = document.createElement('h3');
        title.textContent = `Detalhes da Combina√ß√£o: ${combo.digitos.join(',')}`;
        
        // Informa√ß√µes b√°sicas
        const infoDiv = document.createElement('div');
        infoDiv.className = 'combo-info';
        
        infoDiv.innerHTML = `
            <p><strong>Quantidade de d√≠gitos:</strong> ${combo.quantidade}</p>
            <p><strong>Aparece em ${combo.concursos.length} concursos:</strong> ${combo.concursos.join(', ')}</p>
            <p><strong>M√©dia de intervalo:</strong> ${combo.mediaIntervalos || '-'} concursos</p>
            <p><strong>Menor intervalo:</strong> ${combo.menorIntervalo || '-'} concursos</p>
            <p><strong>Maior intervalo:</strong> ${combo.maiorIntervalo || '-'} concursos</p>
            <p><strong>√öltimo intervalo:</strong> ${combo.ultimoIntervalo || '-'} concursos</p>
        `;
        
        // Intervalos entre concursos
        if (combo.intervalos && combo.intervalos.length > 0) {
            const intervalosDiv = document.createElement('div');
            intervalosDiv.className = 'intervalos-info';
            
            const intervalosTitle = document.createElement('h4');
            intervalosTitle.textContent = 'Intervalos entre Concursos';
            intervalosDiv.appendChild(intervalosTitle);
            
            const intervalosTable = document.createElement('table');
            intervalosTable.className = 'intervalos-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['De Concurso', 'Para Concurso', 'Intervalo'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            intervalosTable.appendChild(headerRow);
            
            // Dados de intervalos
            for (let i = 1; i < combo.concursos.length; i++) {
                const row = document.createElement('tr');
                
                // De concurso
                const tdDe = document.createElement('td');
                tdDe.textContent = combo.concursos[i-1];
                row.appendChild(tdDe);
                
                // Para concurso
                const tdPara = document.createElement('td');
                tdPara.textContent = combo.concursos[i];
                row.appendChild(tdPara);
                
                // Intervalo
                const tdIntervalo = document.createElement('td');
                tdIntervalo.textContent = combo.concursos[i] - combo.concursos[i-1];
                row.appendChild(tdIntervalo);
                
                intervalosTable.appendChild(row);
            }
            
            intervalosDiv.appendChild(intervalosTable);
            infoDiv.appendChild(intervalosDiv);
        }
        
        // Combina√ß√µes similares
        const similaresDiv = document.createElement('div');
        similaresDiv.className = 'similares-info';
        
        if (combo.similares && combo.similares.length > 0) {
            const similaresTitle = document.createElement('h4');
            similaresTitle.textContent = 'Combina√ß√µes Similares';
            similaresDiv.appendChild(similaresTitle);
            
            const similaresTable = document.createElement('table');
            similaresTable.className = 'similares-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['D√≠gitos Comuns', 'D√≠gitos Diferentes', 'Aparece em', 'Frequ√™ncia'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            similaresTable.appendChild(headerRow);
            
            // Dados de combina√ß√µes similares
            combo.similares.forEach(similar => {
                const row = document.createElement('tr');
                
                // D√≠gitos comuns
                const tdComuns = document.createElement('td');
                tdComuns.textContent = similar.digitosComuns.join(',');
                row.appendChild(tdComuns);
                
                // D√≠gitos diferentes
                const tdDiferentes = document.createElement('td');
                tdDiferentes.innerHTML = `
                    <span class="diferencas">
                        <span class="de">${similar.digitosDiferentes.de.join(',') || '-'}</span> ‚Üí
                        <span class="para">${similar.digitosDiferentes.para.join(',') || '-'}</span>
                    </span>
                `;
                row.appendChild(tdDiferentes);
                
                // Aparece em
                const tdConcursos = document.createElement('td');
                tdConcursos.textContent = similar.concursos.slice(0, 5).join(', ');
                if (similar.concursos.length > 5) {
                    tdConcursos.textContent += ` (+ ${similar.concursos.length - 5} outros)`;
                }
                row.appendChild(tdConcursos);
                
                // Frequ√™ncia
                const tdFreq = document.createElement('td');
                tdFreq.textContent = similar.concursos.length;
                row.appendChild(tdFreq);
                
                similaresTable.appendChild(row);
            });
            
            similaresDiv.appendChild(similaresTable);
        } else {
            similaresDiv.innerHTML = '<p>Nenhuma combina√ß√£o similar encontrada.</p>';
        }
        
        // Adicionar todos os elementos ao modal
        modalContent.appendChild(closeBtn);
        modalContent.appendChild(title);
        modalContent.appendChild(infoDiv);
        modalContent.appendChild(similaresDiv);
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fechar o modal ao clicar fora dele
        window.onclick = (event) => {
            if (event.target === modal) {
                document.body.removeChild(modal);
            }
        };
    }
    
    // Fun√ß√£o para renderizar os resultados na tabela
    function renderResults(results) {
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = '';
        
        // Atualizar informa√ß√£o sobre resultados filtrados
        const resultsInfoDiv = document.getElementById('resultadosInfo');
        if (!resultsInfoDiv) {
            const infoDiv = document.createElement('div');
            infoDiv.id = 'resultadosInfo';
            infoDiv.className = 'results-info';
            infoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
            
            // Inserir antes da tabela
            const tableContainer = document.getElementById('diaDeSorteResults').parentNode;
            tableContainer.insertBefore(infoDiv, document.getElementById('diaDeSorteResults'));
        } else {
            resultsInfoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
        }
        
        results.forEach(result => {
            const row = tableBody.insertRow();
            
            // Formatar data
            const dataParts = result.data ? result.data.split('/') : ['', '', ''];
            const dataFormatada = dataParts.length === 3 ? `${dataParts[0]}/${dataParts[1]}/${dataParts[2]}` : result.data;
            
            row.innerHTML = `
                <td>${result.concurso}</td>
                <td>${dataFormatada}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
                <td>
                    <button class="copy-button" data-digits="${result.digitos_para_copia}">
                        Copiar
                    </button>
                </td>
            `;
        });
        
        // Adicionar event listeners para os bot√µes de c√≥pia
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', function() {
                const digits = this.getAttribute('data-digits');
                navigator.clipboard.writeText(digits)
                    .then(() => {
                        // Feedback visual para o usu√°rio
                        const originalText = this.textContent;
                        this.textContent = 'Copiado!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Erro ao copiar os d√≠gitos.');
                    });
            });
        });
    }
    
    // Fun√ß√£o para renderizar estat√≠sticas dos d√≠gitos
    function renderDigitStats(stats) {
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        
        // Ordenar os d√≠gitos por frequ√™ncia (do maior para o menor)
        const sortedDigits = Object.entries(stats).sort((a, b) => b[1] - a[1]);
        
        // Criar visualiza√ß√£o da frequ√™ncia de d√≠gitos - Ordenada por frequ√™ncia
        sortedDigits.forEach(([digit, count]) => {
            const digitBox = document.createElement('div');
            digitBox.className = 'digit-box';
            digitBox.innerHTML = `${digit}<span class="digit-count">${count}</span>`;
            digitFrequencyDiv.appendChild(digitBox);
        });
        
        // Criar gr√°fico de barras para frequ√™ncia de d√≠gitos - Ordenado por frequ√™ncia
        const maxCount = Math.max(...Object.values(stats));
        const chartHtml = sortedDigits.map(([digit, count]) => {
            const percentage = (count / maxCount) * 100;
            return `
                <div style="margin: 10px 0;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 20px; text-align: center;">${digit}</div>
                        <div style="flex-grow: 1; margin: 0 10px;">
                            <div style="background-color: #4CAF50; height: 20px; width: ${percentage}%;"></div>
                        </div>
                        <div style="width: 40px; text-align: right;">${count}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        digitChartDiv.innerHTML = chartHtml;
    }
    
// Fun√ß√µes para download
 function downloadCSV() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criando uma tabela HTML que o Excel pode importar corretamente
    let excelContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">';
    excelContent += '<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>D√≠gitos Dia de Sorte</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->';
    excelContent += '<style>th { background-color: #000000; color: #ffffff; text-align: left; font-weight: bold; } td { text-align: left; } .concurso { mso-number-format:"0"; }</style>';
    excelContent += '</head>';
    excelContent += '<body><table border="1">';
    
    // Adicionar cabe√ßalho com acentos corretos e formata√ß√£o (fundo preto, fonte branca)
    excelContent += '<tr>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Concurso</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Data</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Dezenas</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos Ordenados</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Qtd. D√≠gitos</th>';
    excelContent += '</tr>';
    
    // Adicionar dados (alinhados √† esquerda)
    filteredResults.forEach(result => {
        excelContent += '<tr>';
        excelContent += `<td class="concurso" style="text-align: left;">${result.concurso}</td>`;
        excelContent += `<td style="text-align: left;">${result.data}</td>`;
        excelContent += `<td style="text-align: left;">${result.dezenas.join(' - ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_para_exibicao || result.digitos.join(' ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_ordenados.join(',')}</td>`;
        excelContent += `<td style="text-align: left;">${result.contagem_digitos}</td>`;
        excelContent += '</tr>';
    });
    
    excelContent += '</table></body></html>';
    
    // Criar o blob com tipo MIME para Excel
    const blob = new Blob([excelContent], {type: 'application/vnd.ms-excel'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.xls';
    link.click();
}
   
function downloadJSON() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criar conte√∫do HTML formatado
    let htmlContent = `
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>An√°lise de D√≠gitos do Dia de Sorte</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f0f8ff;
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 5px;
            }
            h1, h2, h3 {
                color: #006400;
                text-align: center;
            }
            .section {
                margin-bottom: 30px;
                padding: 15px;
                background-color: #f9f9f9;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
            }
            th {
                background-color: #000000;
                color: white;
                padding: 10px;
                text-align: left;
            }
            td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }
            tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            .digit-box {
                display: inline-block;
                width: 40px;
                height: 40px;
                line-height: 40px;
                text-align: center;
                margin: 5px;
                background-color: #4CAF50;
                color: white;
                border-radius: 50%;
                font-weight: bold;
            }
            .digit-count {
                font-size: 12px;
                color: #666;
                display: block;
                text-align: center;
            }
            .footer {
                text-align: center;
                margin-top: 20px;
                font-size: 12px;
                color: #666;
                padding: 10px;
                border-top: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>An√°lise de D√≠gitos do Dia de Sorte</h1>
            
            <div class="section">
                <h2>Estat√≠sticas de Frequ√™ncia dos D√≠gitos</h2>
                <div style="display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
    `;
    
    // Adicionar estat√≠sticas de d√≠gitos
    const sortedDigits = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
    sortedDigits.forEach(([digit, count]) => {
        htmlContent += `
            <div class="digit-box">${digit}
                <span class="digit-count">${count} vezes</span>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
                
                <h3>Gr√°fico de Frequ√™ncia</h3>
                <div style="padding: 15px;">
    `;
    
    // Adicionar gr√°fico de barras simples
    const maxCount = Math.max(...Object.values(digitStats));
    sortedDigits.forEach(([digit, count]) => {
        const percentage = (count / maxCount) * 100;
        htmlContent += `
            <div style="margin: 10px 0; display: flex; align-items: center;">
                <div style="width: 30px; text-align: center; font-weight: bold;">${digit}</div>
                <div style="flex-grow: 1; margin: 0 10px;">
                    <div style="background-color: #4CAF50; height: 24px; width: ${percentage}%;"></div>
                </div>
                <div style="width: 60px; text-align: right;">${count}</div>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
            </div>
            
            <div class="section">
                <h2>Resumo por Quantidade de D√≠gitos</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Qtd. D√≠gitos</th>
                            <th>N√∫mero de Sorteios</th>
                            <th>Porcentagem</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resumo por quantidade de d√≠gitos
    const qtdKeys = Object.keys(combinationStats.porQuantidade)
        .sort((a, b) => parseInt(a) - parseInt(b));
    
    qtdKeys.forEach(qtd => {
        const count = combinationStats.porQuantidade[qtd].length;
        const percentage = ((count / allResults.length) * 100).toFixed(2);
        htmlContent += `
            <tr>
                <td>${qtd}</td>
                <td>${count}</td>
                <td>${percentage}%</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Combina√ß√µes Mais Frequentes</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Combina√ß√£o</th>
                            <th>Qtd. D√≠gitos</th>
                            <th>Frequ√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar combina√ß√µes mais frequentes
    combinationStats.combinacoesFrequentes.slice(0, 10).forEach(combo => {
        htmlContent += `
            <tr>
                <td>${combo.digitos.join(',')}</td>
                <td>${combo.quantidade}</td>
                <td>${combo.concursos.length}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Resultados Detalhados</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Concurso</th>
                            <th>Data</th>
                            <th>Dezenas</th>
                            <th>D√≠gitos</th>
                            <th>D√≠gitos Ordenados</th>
                            <th>Qtd. D√≠gitos</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resultados detalhados
    filteredResults.forEach(result => {
        htmlContent += `
            <tr>
                <td>${result.concurso}</td>
                <td>${result.data || ''}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="footer">
                <p>Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                <p>Total de resultados analisados: ${allResults.length}</p>
            </div>
        </div>
    </body>
    </html>
    `;
    
    // Criar o blob com tipo MIME para HTML
    const blob = new Blob([htmlContent], {type: 'text/html;charset=utf-8'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.html';
    link.click();
}    
    function downloadTXT() {
        if (allResults.length === 0) {
            alert('Carregue os resultados primeiro!');
            return;
        }
        
        let txtContent = "An√°lise de D√≠gitos do Dia de Sorte\n\n";
        
        // Adicionar estat√≠sticas - ordenar por frequ√™ncia para o arquivo TXT tamb√©m
        txtContent += "ESTAT√çSTICAS DE FREQU√äNCIA DOS D√çGITOS (ORDEM DECRESCENTE):\n";
        const sortedStats = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
        sortedStats.forEach(([digit, count]) => {
            txtContent += `D√≠gito ${digit}: ${count} ocorr√™ncias\n`;
        });
        
        // Adicionar resumo de combina√ß√µes
        txtContent += "\n\nRESUMO POR QUANTIDADE DE D√çGITOS:\n";
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const count = combinationStats.porQuantidade[qtd].length;
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            txtContent += `${qtd} d√≠gitos: ${count} sorteios (${percentage}%)\n`;
        });
        
        // Adicionar combina√ß√µes mais frequentes
        txtContent += "\n\nCOMBINA√á√ïES MAIS FREQUENTES:\n";
        combinationStats.combinacoesFrequentes.slice(0, 5).forEach((combo, index) => {
            txtContent += `${index + 1}. Combina√ß√£o [${combo.digitos.join(',')}]: Aparece em ${combo.concursos.length} sorteios\n`;
        });
        
        txtContent += "\n\nRESULTADOS DETALHADOS:\n";
        filteredResults.forEach(result => {
            const digitos = result.digitos_para_exibicao || result.digitos.join(' ');
            const digitosOrdenados = result.digitos_ordenados.join(',');
            txtContent += `Concurso: ${result.concurso} | Data: ${result.data} | Dezenas: ${result.dezenas.join('-')} | `;
            txtContent += `D√≠gitos: ${digitos} | Ordenados: ${digitosOrdenados} | `;
            txtContent += `Quantidade: ${result.contagem_digitos}\n`;
        });
        
        // Criar o blob com tipo MIME para texto
        const blob = new Blob([txtContent], {type: 'text/plain;charset=utf-8'});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = 'analise_digitos_diadesorte.txt';
        link.click();
    }
	
	// Fun√ß√£o auxiliar para download de arquivos
	function downloadFile(content, fileName, type) {
    const blob = new Blob([content], { type });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    link.click();
    console.log("Download iniciado:", fileName);
	}
	
});

document.addEventListener('DOMContentLoaded', function() {
    const loadButton = document.getElementById('loadButton');
    const downloadCSVButton = document.getElementById('downloadCSV');
    const downloadJSONButton = document.getElementById('downloadJSON');
    const downloadTXTButton = document.getElementById('downloadTXT');
    
    let allResults = [];
    let filteredResults = [];
    let digitStats = {};
    let combinationStats = {};
    
    // Registrar eventos de clique
    loadButton.addEventListener('click', fetchDigitosResults);
    downloadCSVButton.addEventListener('click', downloadCSV);
    downloadJSONButton.addEventListener('click', downloadJSON);
    downloadTXTButton.addEventListener('click', downloadTXT);
	
	
	// Chamar fetchDigitosResults automaticamente quando a p√°gina carregar
    fetchDigitosResults();
    
    // Fun√ß√£o para buscar os resultados - com tratamento de erros melhorado
    async function fetchDigitosResults() {
		// No in√≠cio da fun√ß√£o fetchDigitosResults
		console.log("Fun√ß√£o fetchDigitosResults iniciada");
		
		const loadButton = document.getElementById('loadButton');

		// Desabilitar o bot√£o enquanto carrega
		if (loadButton) {
			loadButton.disabled = true;
			loadButton.style.opacity = '0.6';
			loadButton.style.cursor = 'not-allowed';
		}
		
        const loadingMessage = document.getElementById('loadingMessage');
        const completedMessage = document.getElementById('completedMessage');
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        const filterContainerDiv = document.getElementById('filterContainer');
        
        loadingMessage.style.display = 'block';
        completedMessage.style.display = 'none';
        tableBody.innerHTML = '';
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        combinationAnalysisDiv.innerHTML = '';
        filterContainerDiv.innerHTML = '';
        
        try {
            console.log("Iniciando fetch de dados...");
            const response = await fetch('/api/digitos');
            console.log("Status da resposta:", response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error("Erro na resposta:", errorText);
                throw new Error(`Erro ao acessar a API. Status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("Dados recebidos:", data);
            
            if (data.resultados && Array.isArray(data.resultados)) {
                allResults = data.resultados;
				// Compartilhar resultados no escopo global
				window.allResults = allResults;
				window.digitStats = digitStats;
				
				
                filteredResults = [...allResults]; // Inicialmente, todos os resultados
                digitStats = data.frequencia_digitos;
                
                // Analisar combina√ß√µes de d√≠gitos
                analisarCombinacoes(allResults);
                
                // Renderizar tudo
                renderFilterOptions();
                renderResults(filteredResults);
                renderDigitStats(digitStats);
                renderCombinationAnalysis();
            } else {
                console.error("Formato inv√°lido:", data);
                throw new Error('Formato de dados inv√°lido.');
            }
        } catch (error) {
            console.error("Erro detalhado:", error);
            alert('Erro ao buscar os resultados: ' + error.message);
        } finally {
            loadingMessage.style.display = 'none';
            completedMessage.style.display = 'block';
			
			// Reabilitar o bot√£o quando o carregamento terminar
			if (loadButton) {
				loadButton.disabled = false;
				loadButton.style.opacity = '1';
				loadButton.style.cursor = 'pointer';
			}
        }
    }
    
    // Fun√ß√£o para analisar combina√ß√µes de d√≠gitos
    function analisarCombinacoes(results) {
        combinationStats = {
            porQuantidade: {}, // Agrupar por quantidade de d√≠gitos
            combinacoesFrequentes: {}, // Combina√ß√µes mais frequentes
            digitosExclusivos: {} // D√≠gitos que aparecem apenas em alguns sorteios
        };
        
        // Agrupar resultados por quantidade de d√≠gitos
        results.forEach(result => {
            const qtd = result.contagem_digitos;
            if (!combinationStats.porQuantidade[qtd]) {
                combinationStats.porQuantidade[qtd] = [];
            }
            combinationStats.porQuantidade[qtd].push(result);
        });
        
        // Encontrar combina√ß√µes frequentes
        results.forEach(result => {
            const combinacao = result.digitos_ordenados.join(',');
            if (!combinationStats.combinacoesFrequentes[combinacao]) {
                combinationStats.combinacoesFrequentes[combinacao] = {
                    combinacao: combinacao,
                    concursos: [],
                    digitos: result.digitos_ordenados,
                    quantidade: result.contagem_digitos
                };
            }
            combinationStats.combinacoesFrequentes[combinacao].concursos.push(result.concurso);
        });
        
        // Ordenar combina√ß√µes por frequ√™ncia
        combinationStats.combinacoesFrequentes = Object.values(combinationStats.combinacoesFrequentes)
            .sort((a, b) => b.concursos.length - a.concursos.length);
        
        // Analisar similaridades e diferen√ßas entre combina√ß√µes
        for (let i = 0; i < combinationStats.combinacoesFrequentes.length; i++) {
            const combo = combinationStats.combinacoesFrequentes[i];
            combo.similares = [];
            
            for (let j = 0; j < combinationStats.combinacoesFrequentes.length; j++) {
                if (i === j) continue;
                
                const outroCombo = combinationStats.combinacoesFrequentes[j];
                
                // Comparar os d√≠gitos
                const digitosCombo = new Set(combo.digitos);
                const digitosOutroCombo = new Set(outroCombo.digitos);
                
                // Diferen√ßas
                const digitosExclusivosCombo1 = [...digitosCombo].filter(d => !digitosOutroCombo.has(d));
                const digitosExclusivosCombo2 = [...digitosOutroCombo].filter(d => !digitosCombo.has(d));
                
                // Interse√ß√£o
                const digitosComuns = [...digitosCombo].filter(d => digitosOutroCombo.has(d));
                
                // Se tem similaridade significativa (mais de 70% em comum)
                if (digitosComuns.length >= combo.digitos.length * 0.7) {
                    combo.similares.push({
                        concursos: outroCombo.concursos,
                        digitosComuns: digitosComuns,
                        digitosDiferentes: {
                            de: digitosExclusivosCombo1,
                            para: digitosExclusivosCombo2
                        }
                    });
                }
            }
            
            // Limitar a 5 combina√ß√µes similares por combina√ß√£o
            combo.similares = combo.similares.slice(0, 5);
        }
        
        // Calcular estat√≠sticas adicionais para as combina√ß√µes frequentes
        combinationStats.combinacoesFrequentes.forEach(combo => {
            // Ordenar concursos
            combo.concursos.sort((a, b) => a - b);
            
            // Calcular intervalos
            const intervalos = [];
            for (let i = 1; i < combo.concursos.length; i++) {
                intervalos.push(combo.concursos[i] - combo.concursos[i-1]);
            }
            
            if (intervalos.length > 0) {
                combo.intervalos = intervalos;
                combo.mediaIntervalos = Math.round(intervalos.reduce((a, b) => a + b, 0) / intervalos.length);
                combo.menorIntervalo = Math.min(...intervalos);
                combo.maiorIntervalo = Math.max(...intervalos);
                combo.ultimoIntervalo = intervalos[intervalos.length - 1];
            }
        });
        
        // Limitar as combina√ß√µes mais frequentes √†s top 10
        combinationStats.combinacoesFrequentes = combinationStats.combinacoesFrequentes.slice(0, 10);
        
        // Compartilhar resultados analisados no escopo global para uso pelo resumo-simples.js
        window.resultadosAnalisados = {
            combinacoesOrdenadas: combinationStats.combinacoesFrequentes,
            mediaGeral: combinationStats.combinacoesFrequentes.reduce((acc, c) => acc + (c.mediaIntervalos || 0), 0) / 
                        combinationStats.combinacoesFrequentes.filter(c => c.mediaIntervalos).length
        };
    }
    
    // Fun√ß√£o para renderizar op√ß√µes de filtro
    function renderFilterOptions() {
        const filterContainerDiv = document.getElementById('filterContainer');
        
        // Clear filter container
        filterContainerDiv.innerHTML = '';
        
        // Criar o t√≠tulo
        const filterTitle = document.createElement('h3');
        filterTitle.textContent = 'Filtros';
        filterContainerDiv.appendChild(filterTitle);
        
        // Criar container de filtros
        const filtersDiv = document.createElement('div');
        filtersDiv.className = 'filters';
        
        // 1. Filtro por quantidade de d√≠gitos
        const qtdDigitosDiv = document.createElement('div');
        qtdDigitosDiv.className = 'filter-item';
        
        const qtdDigitosLabel = document.createElement('label');
        qtdDigitosLabel.textContent = 'Qtd. D√≠gitos: ';
        
        const qtdDigitosSelect = document.createElement('select');
        qtdDigitosSelect.id = 'qtdDigitosFilter';
        
        // Op√ß√£o "Todos"
        const optionTodos = document.createElement('option');
        optionTodos.value = '';
        optionTodos.textContent = 'Todos';
        qtdDigitosSelect.appendChild(optionTodos);
        
        // Quantidades dispon√≠veis
        const quantidades = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        quantidades.forEach(qtd => {
            const option = document.createElement('option');
            option.value = qtd;
            option.textContent = `${qtd} d√≠gitos (${combinationStats.porQuantidade[qtd].length} resultados)`;
            qtdDigitosSelect.appendChild(option);
        });
        
        qtdDigitosDiv.appendChild(qtdDigitosLabel);
        qtdDigitosDiv.appendChild(qtdDigitosSelect);
        
        // 2. Filtro por d√≠gito espec√≠fico
        const digitoEspecificoDiv = document.createElement('div');
        digitoEspecificoDiv.className = 'filter-item';
        
        const digitoEspecificoLabel = document.createElement('label');
        digitoEspecificoLabel.textContent = 'Cont√©m D√≠gito: ';
        
        const digitoEspecificoSelect = document.createElement('select');
        digitoEspecificoSelect.id = 'digitoEspecificoFilter';
        
        // Op√ß√£o "Todos"
        const optionTodosDigitos = document.createElement('option');
        optionTodosDigitos.value = '';
        optionTodosDigitos.textContent = 'Todos';
        digitoEspecificoSelect.appendChild(optionTodosDigitos);
        
        // Listar todos os d√≠gitos ordenados por frequ√™ncia
        const digitosPorFrequencia = Object.entries(digitStats)
            .sort((a, b) => b[1] - a[1]);
        
        digitosPorFrequencia.forEach(([digito, frequencia]) => {
            const option = document.createElement('option');
            option.value = digito;
            option.textContent = `D√≠gito ${digito} (${frequencia} ocorr√™ncias)`;
            digitoEspecificoSelect.appendChild(option);
        });
        
        digitoEspecificoDiv.appendChild(digitoEspecificoLabel);
        digitoEspecificoDiv.appendChild(digitoEspecificoSelect);
        
        // 3. Bot√£o de aplicar filtro
        const aplicarFiltroBtn = document.createElement('button');
        aplicarFiltroBtn.textContent = 'Aplicar Filtros';
        aplicarFiltroBtn.className = 'button';
        aplicarFiltroBtn.onclick = aplicarFiltros;
        
        // 4. Bot√£o de limpar filtro
        const limparFiltroBtn = document.createElement('button');
        limparFiltroBtn.textContent = 'Limpar Filtros';
        limparFiltroBtn.className = 'button';
        limparFiltroBtn.onclick = limparFiltros;
        
        // Adicionar todos os elementos ao container
        filtersDiv.appendChild(qtdDigitosDiv);
        filtersDiv.appendChild(digitoEspecificoDiv);
        filtersDiv.appendChild(aplicarFiltroBtn);
        filtersDiv.appendChild(limparFiltroBtn);
        
        filterContainerDiv.appendChild(filtersDiv);
    }
    
    // Fun√ß√£o para aplicar filtros
    function aplicarFiltros() {
        const qtdDigitosFilter = document.getElementById('qtdDigitosFilter').value;
        const digitoEspecificoFilter = document.getElementById('digitoEspecificoFilter').value;
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        
        // Aplicar filtro de quantidade de d√≠gitos
        if (qtdDigitosFilter) {
            filteredResults = filteredResults.filter(
                result => result.contagem_digitos == parseInt(qtdDigitosFilter)
            );
        }
        
        // Aplicar filtro de d√≠gito espec√≠fico
        if (digitoEspecificoFilter) {
            filteredResults = filteredResults.filter(
                result => result.digitos_ordenados.includes(digitoEspecificoFilter)
            );
        }
        
        // Renderizar resultados filtrados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para limpar filtros
    function limparFiltros() {
        document.getElementById('qtdDigitosFilter').value = '';
        document.getElementById('digitoEspecificoFilter').value = '';
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para renderizar a an√°lise de combina√ß√µes
    function renderCombinationAnalysis() {
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        
        // T√≠tulo da se√ß√£o
        const title = document.createElement('h3');
        title.textContent = 'An√°lise de Combina√ß√µes de D√≠gitos';
        combinationAnalysisDiv.appendChild(title);
        
        // 1. Combina√ß√µes mais frequentes
        const combinacoesFrequentesTitle = document.createElement('h4');
        combinacoesFrequentesTitle.textContent = 'Combina√ß√µes Mais Frequentes';
        combinationAnalysisDiv.appendChild(combinacoesFrequentesTitle);
        
        const combinacoesTable = document.createElement('table');
        combinacoesTable.className = 'combinations-table';
        
		// Cabe√ßalho da tabela
		const headerRow = document.createElement('tr');
		[
			'Combina√ß√£o', 
			'Qtd. D√≠gitos', 
			'Frequ√™ncia', 
			'Detalhes'
		].forEach(text => {
			const th = document.createElement('th');
			th.textContent = text;
			headerRow.appendChild(th);
		});        combinacoesTable.appendChild(headerRow);
        
        // Dados da tabela
        combinationStats.combinacoesFrequentes.forEach(combo => {
            const row = document.createElement('tr');
            
            // Combina√ß√£o
            const tdCombo = document.createElement('td');
            tdCombo.textContent = combo.digitos.join(',');
            row.appendChild(tdCombo);
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = combo.quantidade;
            row.appendChild(tdQtd);
            
            // Frequ√™ncia (n√∫mero de concursos)
            const tdFreq = document.createElement('td');
            tdFreq.textContent = combo.concursos.length;
            row.appendChild(tdFreq);
            
            // Bot√£o para ver detalhes
            const tdDetails = document.createElement('td');
            const detailsBtn = document.createElement('button');
            detailsBtn.textContent = 'Ver Detalhes';
            detailsBtn.className = 'details-button';
            detailsBtn.onclick = () => {
                mostrarDetalhesCombinacao(combo);
            };
            tdDetails.appendChild(detailsBtn);
            row.appendChild(tdDetails);
            
            combinacoesTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(combinacoesTable);
        
        // 2. Resumo por quantidade de d√≠gitos
        const resumoQtdTitle = document.createElement('h4');
        resumoQtdTitle.textContent = 'Resumo por Quantidade de D√≠gitos';
        combinationAnalysisDiv.appendChild(resumoQtdTitle);
        
        const resumoTable = document.createElement('table');
        resumoTable.className = 'summary-table';
        
        // Cabe√ßalho da tabela
        const resumoHeader = document.createElement('tr');
        ['Qtd. D√≠gitos', 'N√∫mero de Sorteios', 'Porcentagem'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            resumoHeader.appendChild(th);
        });
        resumoTable.appendChild(resumoHeader);
        
        // Dados da tabela
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const row = document.createElement('tr');
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = qtd;
            row.appendChild(tdQtd);
            
            // N√∫mero de sorteios
            const count = combinationStats.porQuantidade[qtd].length;
            const tdCount = document.createElement('td');
            tdCount.textContent = count;
            row.appendChild(tdCount);
            
            // Porcentagem
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            const tdPercentage = document.createElement('td');
            tdPercentage.textContent = `${percentage}%`;
            row.appendChild(tdPercentage);
            
            resumoTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(resumoTable);
    }
    
    // Fun√ß√£o para mostrar detalhes de uma combina√ß√£o
    function mostrarDetalhesCombinacao(combo) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        // Fechar modal
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-button';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = () => {
            document.body.removeChild(modal);
        };
        
        // T√≠tulo
        const title = document.createElement('h3');
        title.textContent = `Detalhes da Combina√ß√£o: ${combo.digitos.join(',')}`;
        
        // Informa√ß√µes b√°sicas
        const infoDiv = document.createElement('div');
        infoDiv.className = 'combo-info';
        
        infoDiv.innerHTML = `
            <p><strong>Quantidade de d√≠gitos:</strong> ${combo.quantidade}</p>
            <p><strong>Aparece em ${combo.concursos.length} concursos:</strong> ${combo.concursos.join(', ')}</p>
            <p><strong>M√©dia de intervalo:</strong> ${combo.mediaIntervalos || '-'} concursos</p>
            <p><strong>Menor intervalo:</strong> ${combo.menorIntervalo || '-'} concursos</p>
            <p><strong>Maior intervalo:</strong> ${combo.maiorIntervalo || '-'} concursos</p>
            <p><strong>√öltimo intervalo:</strong> ${combo.ultimoIntervalo || '-'} concursos</p>
        `;
        
        // Intervalos entre concursos
        if (combo.intervalos && combo.intervalos.length > 0) {
            const intervalosDiv = document.createElement('div');
            intervalosDiv.className = 'intervalos-info';
            
            const intervalosTitle = document.createElement('h4');
            intervalosTitle.textContent = 'Intervalos entre Concursos';
            intervalosDiv.appendChild(intervalosTitle);
            
            const intervalosTable = document.createElement('table');
            intervalosTable.className = 'intervalos-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['De Concurso', 'Para Concurso', 'Intervalo'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            intervalosTable.appendChild(headerRow);
            
            // Dados de intervalos
            for (let i = 1; i < combo.concursos.length; i++) {
                const row = document.createElement('tr');
                
                // De concurso
                const tdDe = document.createElement('td');
                tdDe.textContent = combo.concursos[i-1];
                row.appendChild(tdDe);
                
                // Para concurso
                const tdPara = document.createElement('td');
                tdPara.textContent = combo.concursos[i];
                row.appendChild(tdPara);
                
                // Intervalo
                const tdIntervalo = document.createElement('td');
                tdIntervalo.textContent = combo.concursos[i] - combo.concursos[i-1];
                row.appendChild(tdIntervalo);
                
                intervalosTable.appendChild(row);
            }
            
            intervalosDiv.appendChild(intervalosTable);
            infoDiv.appendChild(intervalosDiv);
        }
        
        // Combina√ß√µes similares
        const similaresDiv = document.createElement('div');
        similaresDiv.className = 'similares-info';
        
        if (combo.similares && combo.similares.length > 0) {
            const similaresTitle = document.createElement('h4');
            similaresTitle.textContent = 'Combina√ß√µes Similares';
            similaresDiv.appendChild(similaresTitle);
            
            const similaresTable = document.createElement('table');
            similaresTable.className = 'similares-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['D√≠gitos Comuns', 'D√≠gitos Diferentes', 'Aparece em', 'Frequ√™ncia'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            similaresTable.appendChild(headerRow);
            
            // Dados de combina√ß√µes similares
            combo.similares.forEach(similar => {
                const row = document.createElement('tr');
                
                // D√≠gitos comuns
                const tdComuns = document.createElement('td');
                tdComuns.textContent = similar.digitosComuns.join(',');
                row.appendChild(tdComuns);
                
                // D√≠gitos diferentes
                const tdDiferentes = document.createElement('td');
                tdDiferentes.innerHTML = `
                    <span class="diferencas">
                        <span class="de">${similar.digitosDiferentes.de.join(',') || '-'}</span> ‚Üí
                        <span class="para">${similar.digitosDiferentes.para.join(',') || '-'}</span>
                    </span>
                `;
                row.appendChild(tdDiferentes);
                
                // Aparece em
                const tdConcursos = document.createElement('td');
                tdConcursos.textContent = similar.concursos.slice(0, 5).join(', ');
                if (similar.concursos.length > 5) {
                    tdConcursos.textContent += ` (+ ${similar.concursos.length - 5} outros)`;
                }
                row.appendChild(tdConcursos);
                
                // Frequ√™ncia
                const tdFreq = document.createElement('td');
                tdFreq.textContent = similar.concursos.length;
                row.appendChild(tdFreq);
                
                similaresTable.appendChild(row);
            });
            
            similaresDiv.appendChild(similaresTable);
        } else {
            similaresDiv.innerHTML = '<p>Nenhuma combina√ß√£o similar encontrada.</p>';
        }
        
        // Adicionar todos os elementos ao modal
        modalContent.appendChild(closeBtn);
        modalContent.appendChild(title);
        modalContent.appendChild(infoDiv);
        modalContent.appendChild(similaresDiv);
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fechar o modal ao clicar fora dele
        window.onclick = (event) => {
            if (event.target === modal) {
                document.body.removeChild(modal);
            }
        };
    }
    
    // Fun√ß√£o para renderizar os resultados na tabela
    function renderResults(results) {
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = '';
        
        // Atualizar informa√ß√£o sobre resultados filtrados
        const resultsInfoDiv = document.getElementById('resultadosInfo');
        if (!resultsInfoDiv) {
            const infoDiv = document.createElement('div');
            infoDiv.id = 'resultadosInfo';
            infoDiv.className = 'results-info';
            infoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
            
            // Inserir antes da tabela
            const tableContainer = document.getElementById('diaDeSorteResults').parentNode;
            tableContainer.insertBefore(infoDiv, document.getElementById('diaDeSorteResults'));
        } else {
            resultsInfoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
        }
        
        results.forEach(result => {
            const row = tableBody.insertRow();
            
            // Formatar data
            const dataParts = result.data ? result.data.split('/') : ['', '', ''];
            const dataFormatada = dataParts.length === 3 ? `${dataParts[0]}/${dataParts[1]}/${dataParts[2]}` : result.data;
            
            row.innerHTML = `
                <td>${result.concurso}</td>
                <td>${dataFormatada}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
                <td>
                    <button class="copy-button" data-digits="${result.digitos_para_copia}">
                        Copiar
                    </button>
                </td>
            `;
        });
        
        // Adicionar event listeners para os bot√µes de c√≥pia
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', function() {
                const digits = this.getAttribute('data-digits');
                navigator.clipboard.writeText(digits)
                    .then(() => {
                        // Feedback visual para o usu√°rio
                        const originalText = this.textContent;
                        this.textContent = 'Copiado!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Erro ao copiar os d√≠gitos.');
                    });
            });
        });
    }
    
    // Fun√ß√£o para renderizar estat√≠sticas dos d√≠gitos
    function renderDigitStats(stats) {
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        
        // Ordenar os d√≠gitos por frequ√™ncia (do maior para o menor)
        const sortedDigits = Object.entries(stats).sort((a, b) => b[1] - a[1]);
        
        // Criar visualiza√ß√£o da frequ√™ncia de d√≠gitos - Ordenada por frequ√™ncia
        sortedDigits.forEach(([digit, count]) => {
            const digitBox = document.createElement('div');
            digitBox.className = 'digit-box';
            digitBox.innerHTML = `${digit}<span class="digit-count">${count}</span>`;
            digitFrequencyDiv.appendChild(digitBox);
        });
        
        // Criar gr√°fico de barras para frequ√™ncia de d√≠gitos - Ordenado por frequ√™ncia
        const maxCount = Math.max(...Object.values(stats));
        const chartHtml = sortedDigits.map(([digit, count]) => {
            const percentage = (count / maxCount) * 100;
            return `
                <div style="margin: 10px 0;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 20px; text-align: center;">${digit}</div>
                        <div style="flex-grow: 1; margin: 0 10px;">
                            <div style="background-color: #4CAF50; height: 20px; width: ${percentage}%;"></div>
                        </div>
                        <div style="width: 40px; text-align: right;">${count}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        digitChartDiv.innerHTML = chartHtml;
    }
    
// Fun√ß√µes para download
 function downloadCSV() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criando uma tabela HTML que o Excel pode importar corretamente
    let excelContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">';
    excelContent += '<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>D√≠gitos Dia de Sorte</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->';
    excelContent += '<style>th { background-color: #000000; color: #ffffff; text-align: left; font-weight: bold; } td { text-align: left; } .concurso { mso-number-format:"0"; }</style>';
    excelContent += '</head>';
    excelContent += '<body><table border="1">';
    
    // Adicionar cabe√ßalho com acentos corretos e formata√ß√£o (fundo preto, fonte branca)
    excelContent += '<tr>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Concurso</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Data</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Dezenas</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos Ordenados</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Qtd. D√≠gitos</th>';
    excelContent += '</tr>';
    
    // Adicionar dados (alinhados √† esquerda)
    filteredResults.forEach(result => {
        excelContent += '<tr>';
        excelContent += `<td class="concurso" style="text-align: left;">${result.concurso}</td>`;
        excelContent += `<td style="text-align: left;">${result.data}</td>`;
        excelContent += `<td style="text-align: left;">${result.dezenas.join(' - ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_para_exibicao || result.digitos.join(' ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_ordenados.join(',')}</td>`;
        excelContent += `<td style="text-align: left;">${result.contagem_digitos}</td>`;
        excelContent += '</tr>';
    });
    
    excelContent += '</table></body></html>';
    
    // Criar o blob com tipo MIME para Excel
    const blob = new Blob([excelContent], {type: 'application/vnd.ms-excel'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.xls';
    link.click();
}
   
function downloadJSON() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criar conte√∫do HTML formatado
    let htmlContent = `
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>An√°lise de D√≠gitos do Dia de Sorte</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f0f8ff;
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 5px;
            }
            h1, h2, h3 {
                color: #006400;
                text-align: center;
            }
            .section {
                margin-bottom: 30px;
                padding: 15px;
                background-color: #f9f9f9;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
            }
            th {
                background-color: #000000;
                color: white;
                padding: 10px;
                text-align: left;
            }
            td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }
            tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            .digit-box {
                display: inline-block;
                width: 40px;
                height: 40px;
                line-height: 40px;
                text-align: center;
                margin: 5px;
                background-color: #4CAF50;
                color: white;
                border-radius: 50%;
                font-weight: bold;
            }
            .digit-count {
                font-size: 12px;
                color: #666;
                display: block;
                text-align: center;
            }
            .footer {
                text-align: center;
                margin-top: 20px;
                font-size: 12px;
                color: #666;
                padding: 10px;
                border-top: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>An√°lise de D√≠gitos do Dia de Sorte</h1>
            
            <div class="section">
                <h2>Estat√≠sticas de Frequ√™ncia dos D√≠gitos</h2>
                <div style="display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
    `;
    
    // Adicionar estat√≠sticas de d√≠gitos
    const sortedDigits = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
    sortedDigits.forEach(([digit, count]) => {
        htmlContent += `
            <div class="digit-box">${digit}
                <span class="digit-count">${count} vezes</span>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
                
                <h3>Gr√°fico de Frequ√™ncia</h3>
                <div style="padding: 15px;">
    `;
    
    // Adicionar gr√°fico de barras simples
    const maxCount = Math.max(...Object.values(digitStats));
    sortedDigits.forEach(([digit, count]) => {
        const percentage = (count / maxCount) * 100;
        htmlContent += `
            <div style="margin: 10px 0; display: flex; align-items: center;">
                <div style="width: 30px; text-align: center; font-weight: bold;">${digit}</div>
                <div style="flex-grow: 1; margin: 0 10px;">
                    <div style="background-color: #4CAF50; height: 24px; width: ${percentage}%;"></div>
                </div>
                <div style="width: 60px; text-align: right;">${count}</div>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
            </div>
            
            <div class="section">
                <h2>Resumo por Quantidade de D√≠gitos</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Qtd. D√≠gitos</th>
                            <th>N√∫mero de Sorteios</th>
                            <th>Porcentagem</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resumo por quantidade de d√≠gitos
    const qtdKeys = Object.keys(combinationStats.porQuantidade)
        .sort((a, b) => parseInt(a) - parseInt(b));
    
    qtdKeys.forEach(qtd => {
        const count = combinationStats.porQuantidade[qtd].length;
        const percentage = ((count / allResults.length) * 100).toFixed(2);
        htmlContent += `
            <tr>
                <td>${qtd}</td>
                <td>${count}</td>
                <td>${percentage}%</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Combina√ß√µes Mais Frequentes</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Combina√ß√£o</th>
                            <th>Qtd. D√≠gitos</th>
                            <th>Frequ√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar combina√ß√µes mais frequentes
    combinationStats.combinacoesFrequentes.slice(0, 10).forEach(combo => {
        htmlContent += `
            <tr>
                <td>${combo.digitos.join(',')}</td>
                <td>${combo.quantidade}</td>
                <td>${combo.concursos.length}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Resultados Detalhados</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Concurso</th>
                            <th>Data</th>
                            <th>Dezenas</th>
                            <th>D√≠gitos</th>
                            <th>D√≠gitos Ordenados</th>
                            <th>Qtd. D√≠gitos</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resultados detalhados
    filteredResults.forEach(result => {
        htmlContent += `
            <tr>
                <td>${result.concurso}</td>
                <td>${result.data || ''}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="footer">
                <p>Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                <p>Total de resultados analisados: ${allResults.length}</p>
            </div>
        </div>
    </body>
    </html>
    `;
    
    // Criar o blob com tipo MIME para HTML
    const blob = new Blob([htmlContent], {type: 'text/html;charset=utf-8'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.html';
    link.click();
}    
    function downloadTXT() {
        if (allResults.length === 0) {
            alert('Carregue os resultados primeiro!');
            return;
        }
        
        let txtContent = "An√°lise de D√≠gitos do Dia de Sorte\n\n";
        
        // Adicionar estat√≠sticas - ordenar por frequ√™ncia para o arquivo TXT tamb√©m
        txtContent += "ESTAT√çSTICAS DE FREQU√äNCIA DOS D√çGITOS (ORDEM DECRESCENTE):\n";
        const sortedStats = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
        sortedStats.forEach(([digit, count]) => {
            txtContent += `D√≠gito ${digit}: ${count} ocorr√™ncias\n`;
        });
        
        // Adicionar resumo de combina√ß√µes
        txtContent += "\n\nRESUMO POR QUANTIDADE DE D√çGITOS:\n";
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const count = combinationStats.porQuantidade[qtd].length;
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            txtContent += `${qtd} d√≠gitos: ${count} sorteios (${percentage}%)\n`;
        });
        
        // Adicionar combina√ß√µes mais frequentes
        txtContent += "\n\nCOMBINA√á√ïES MAIS FREQUENTES:\n";
        combinationStats.combinacoesFrequentes.slice(0, 5).forEach((combo, index) => {
            txtContent += `${index + 1}. Combina√ß√£o [${combo.digitos.join(',')}]: Aparece em ${combo.concursos.length} sorteios\n`;
        });
        
        txtContent += "\n\nRESULTADOS DETALHADOS:\n";
        filteredResults.forEach(result => {
            const digitos = result.digitos_para_exibicao || result.digitos.join(' ');
            const digitosOrdenados = result.digitos_ordenados.join(',');
            txtContent += `Concurso: ${result.concurso} | Data: ${result.data} | Dezenas: ${result.dezenas.join('-')} | `;
            txtContent += `D√≠gitos: ${digitos} | Ordenados: ${digitosOrdenados} | `;
            txtContent += `Quantidade: ${result.contagem_digitos}\n`;
        });
        
        // Criar o blob com tipo MIME para texto
        const blob = new Blob([txtContent], {type: 'text/plain;charset=utf-8'});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = 'analise_digitos_diadesorte.txt';
        link.click();
    }
	
	// Fun√ß√£o auxiliar para download de arquivos
	function downloadFile(content, fileName, type) {
    const blob = new Blob([content], { type });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    link.click();
    console.log("Download iniciado:", fileName);
	}
	
});

document.addEventListener('DOMContentLoaded', function() {
    const loadButton = document.getElementById('loadButton');
    const downloadCSVButton = document.getElementById('downloadCSV');
    const downloadJSONButton = document.getElementById('downloadJSON');
    const downloadTXTButton = document.getElementById('downloadTXT');
    
    let allResults = [];
    let filteredResults = [];
    let digitStats = {};
    let combinationStats = {};
    
    // Registrar eventos de clique
    loadButton.addEventListener('click', fetchDigitosResults);
    downloadCSVButton.addEventListener('click', downloadCSV);
    downloadJSONButton.addEventListener('click', downloadJSON);
    downloadTXTButton.addEventListener('click', downloadTXT);
	
	
	// Chamar fetchDigitosResults automaticamente quando a p√°gina carregar
    fetchDigitosResults();
    
    // Fun√ß√£o para buscar os resultados - com tratamento de erros melhorado
    async function fetchDigitosResults() {
		// No in√≠cio da fun√ß√£o fetchDigitosResults
		console.log("Fun√ß√£o fetchDigitosResults iniciada");
		
		const loadButton = document.getElementById('loadButton');

		// Desabilitar o bot√£o enquanto carrega
		if (loadButton) {
			loadButton.disabled = true;
			loadButton.style.opacity = '0.6';
			loadButton.style.cursor = 'not-allowed';
		}
		
        const loadingMessage = document.getElementById('loadingMessage');
        const completedMessage = document.getElementById('completedMessage');
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        const filterContainerDiv = document.getElementById('filterContainer');
        
        loadingMessage.style.display = 'block';
        completedMessage.style.display = 'none';
        tableBody.innerHTML = '';
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        combinationAnalysisDiv.innerHTML = '';
        filterContainerDiv.innerHTML = '';
        
        try {
            console.log("Iniciando fetch de dados...");
            const response = await fetch('/api/digitos');
            console.log("Status da resposta:", response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error("Erro na resposta:", errorText);
                throw new Error(`Erro ao acessar a API. Status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("Dados recebidos:", data);
            
            if (data.resultados && Array.isArray(data.resultados)) {
                allResults = data.resultados;
				// Compartilhar resultados no escopo global
				window.allResults = allResults;
				window.digitStats = digitStats;
				
				
                filteredResults = [...allResults]; // Inicialmente, todos os resultados
                digitStats = data.frequencia_digitos;
                
                // Analisar combina√ß√µes de d√≠gitos
                analisarCombinacoes(allResults);
                
                // Renderizar tudo
                renderFilterOptions();
                renderResults(filteredResults);
                renderDigitStats(digitStats);
                renderCombinationAnalysis();
            } else {
                console.error("Formato inv√°lido:", data);
                throw new Error('Formato de dados inv√°lido.');
            }
        } catch (error) {
            console.error("Erro detalhado:", error);
            alert('Erro ao buscar os resultados: ' + error.message);
        } finally {
            loadingMessage.style.display = 'none';
            completedMessage.style.display = 'block';
			
			// Reabilitar o bot√£o quando o carregamento terminar
			if (loadButton) {
				loadButton.disabled = false;
				loadButton.style.opacity = '1';
				loadButton.style.cursor = 'pointer';
			}
        }
    }
    
    // Fun√ß√£o para analisar combina√ß√µes de d√≠gitos
    function analisarCombinacoes(results) {
        combinationStats = {
            porQuantidade: {}, // Agrupar por quantidade de d√≠gitos
            combinacoesFrequentes: {}, // Combina√ß√µes mais frequentes
            digitosExclusivos: {} // D√≠gitos que aparecem apenas em alguns sorteios
        };
        
        // Agrupar resultados por quantidade de d√≠gitos
        results.forEach(result => {
            const qtd = result.contagem_digitos;
            if (!combinationStats.porQuantidade[qtd]) {
                combinationStats.porQuantidade[qtd] = [];
            }
            combinationStats.porQuantidade[qtd].push(result);
        });
        
        // Encontrar combina√ß√µes frequentes
        results.forEach(result => {
            const combinacao = result.digitos_ordenados.join(',');
            if (!combinationStats.combinacoesFrequentes[combinacao]) {
                combinationStats.combinacoesFrequentes[combinacao] = {
                    combinacao: combinacao,
                    concursos: [],
                    digitos: result.digitos_ordenados,
                    quantidade: result.contagem_digitos
                };
            }
            combinationStats.combinacoesFrequentes[combinacao].concursos.push(result.concurso);
        });
        
        // Ordenar combina√ß√µes por frequ√™ncia
        combinationStats.combinacoesFrequentes = Object.values(combinationStats.combinacoesFrequentes)
            .sort((a, b) => b.concursos.length - a.concursos.length);
        
        // Analisar similaridades e diferen√ßas entre combina√ß√µes
        for (let i = 0; i < combinationStats.combinacoesFrequentes.length; i++) {
            const combo = combinationStats.combinacoesFrequentes[i];
            combo.similares = [];
            
            for (let j = 0; j < combinationStats.combinacoesFrequentes.length; j++) {
                if (i === j) continue;
                
                const outroCombo = combinationStats.combinacoesFrequentes[j];
                
                // Comparar os d√≠gitos
                const digitosCombo = new Set(combo.digitos);
                const digitosOutroCombo = new Set(outroCombo.digitos);
                
                // Diferen√ßas
                const digitosExclusivosCombo1 = [...digitosCombo].filter(d => !digitosOutroCombo.has(d));
                const digitosExclusivosCombo2 = [...digitosOutroCombo].filter(d => !digitosCombo.has(d));
                
                // Interse√ß√£o
                const digitosComuns = [...digitosCombo].filter(d => digitosOutroCombo.has(d));
                
                // Se tem similaridade significativa (mais de 70% em comum)
                if (digitosComuns.length >= combo.digitos.length * 0.7) {
                    combo.similares.push({
                        concursos: outroCombo.concursos,
                        digitosComuns: digitosComuns,
                        digitosDiferentes: {
                            de: digitosExclusivosCombo1,
                            para: digitosExclusivosCombo2
                        }
                    });
                }
            }
            
            // Limitar a 5 combina√ß√µes similares por combina√ß√£o
            combo.similares = combo.similares.slice(0, 5);
        }
        
        // Calcular estat√≠sticas adicionais para as combina√ß√µes frequentes
        combinationStats.combinacoesFrequentes.forEach(combo => {
            // Ordenar concursos
            combo.concursos.sort((a, b) => a - b);
            
            // Calcular intervalos
            const intervalos = [];
            for (let i = 1; i < combo.concursos.length; i++) {
                intervalos.push(combo.concursos[i] - combo.concursos[i-1]);
            }
            
            if (intervalos.length > 0) {
                combo.intervalos = intervalos;
                combo.mediaIntervalos = Math.round(intervalos.reduce((a, b) => a + b, 0) / intervalos.length);
                combo.menorIntervalo = Math.min(...intervalos);
                combo.maiorIntervalo = Math.max(...intervalos);
                combo.ultimoIntervalo = intervalos[intervalos.length - 1];
            }
        });
        
        // Limitar as combina√ß√µes mais frequentes √†s top 10
        combinationStats.combinacoesFrequentes = combinationStats.combinacoesFrequentes.slice(0, 10);
        
        // Compartilhar resultados analisados no escopo global para uso pelo resumo-simples.js
        window.resultadosAnalisados = {
            combinacoesOrdenadas: combinationStats.combinacoesFrequentes,
            mediaGeral: combinationStats.combinacoesFrequentes.reduce((acc, c) => acc + (c.mediaIntervalos || 0), 0) / 
                        combinationStats.combinacoesFrequentes.filter(c => c.mediaIntervalos).length
        };
    }
    
    // Fun√ß√£o para renderizar op√ß√µes de filtro
    function renderFilterOptions() {
        const filterContainerDiv = document.getElementById('filterContainer');
        
        // Clear filter container
        filterContainerDiv.innerHTML = '';
        
        // Criar o t√≠tulo
        const filterTitle = document.createElement('h3');
        filterTitle.textContent = 'Filtros';
        filterContainerDiv.appendChild(filterTitle);
        
        // Criar container de filtros
        const filtersDiv = document.createElement('div');
        filtersDiv.className = 'filters';
        
        // 1. Filtro por quantidade de d√≠gitos
        const qtdDigitosDiv = document.createElement('div');
        qtdDigitosDiv.className = 'filter-item';
        
        const qtdDigitosLabel = document.createElement('label');
        qtdDigitosLabel.textContent = 'Qtd. D√≠gitos: ';
        
        const qtdDigitosSelect = document.createElement('select');
        qtdDigitosSelect.id = 'qtdDigitosFilter';
        
        // Op√ß√£o "Todos"
        const optionTodos = document.createElement('option');
        optionTodos.value = '';
        optionTodos.textContent = 'Todos';
        qtdDigitosSelect.appendChild(optionTodos);
        
        // Quantidades dispon√≠veis
        const quantidades = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        quantidades.forEach(qtd => {
            const option = document.createElement('option');
            option.value = qtd;
            option.textContent = `${qtd} d√≠gitos (${combinationStats.porQuantidade[qtd].length} resultados)`;
            qtdDigitosSelect.appendChild(option);
        });
        
        qtdDigitosDiv.appendChild(qtdDigitosLabel);
        qtdDigitosDiv.appendChild(qtdDigitosSelect);
        
        // 2. Filtro por d√≠gito espec√≠fico
        const digitoEspecificoDiv = document.createElement('div');
        digitoEspecificoDiv.className = 'filter-item';
        
        const digitoEspecificoLabel = document.createElement('label');
        digitoEspecificoLabel.textContent = 'Cont√©m D√≠gito: ';
        
        const digitoEspecificoSelect = document.createElement('select');
        digitoEspecificoSelect.id = 'digitoEspecificoFilter';
        
        // Op√ß√£o "Todos"
        const optionTodosDigitos = document.createElement('option');
        optionTodosDigitos.value = '';
        optionTodosDigitos.textContent = 'Todos';
        digitoEspecificoSelect.appendChild(optionTodosDigitos);
        
        // Listar todos os d√≠gitos ordenados por frequ√™ncia
        const digitosPorFrequencia = Object.entries(digitStats)
            .sort((a, b) => b[1] - a[1]);
        
        digitosPorFrequencia.forEach(([digito, frequencia]) => {
            const option = document.createElement('option');
            option.value = digito;
            option.textContent = `D√≠gito ${digito} (${frequencia} ocorr√™ncias)`;
            digitoEspecificoSelect.appendChild(option);
        });
        
        digitoEspecificoDiv.appendChild(digitoEspecificoLabel);
        digitoEspecificoDiv.appendChild(digitoEspecificoSelect);
        
        // 3. Bot√£o de aplicar filtro
        const aplicarFiltroBtn = document.createElement('button');
        aplicarFiltroBtn.textContent = 'Aplicar Filtros';
        aplicarFiltroBtn.className = 'button';
        aplicarFiltroBtn.onclick = aplicarFiltros;
        
        // 4. Bot√£o de limpar filtro
        const limparFiltroBtn = document.createElement('button');
        limparFiltroBtn.textContent = 'Limpar Filtros';
        limparFiltroBtn.className = 'button';
        limparFiltroBtn.onclick = limparFiltros;
        
        // Adicionar todos os elementos ao container
        filtersDiv.appendChild(qtdDigitosDiv);
        filtersDiv.appendChild(digitoEspecificoDiv);
        filtersDiv.appendChild(aplicarFiltroBtn);
        filtersDiv.appendChild(limparFiltroBtn);
        
        filterContainerDiv.appendChild(filtersDiv);
    }
    
    // Fun√ß√£o para aplicar filtros
    function aplicarFiltros() {
        const qtdDigitosFilter = document.getElementById('qtdDigitosFilter').value;
        const digitoEspecificoFilter = document.getElementById('digitoEspecificoFilter').value;
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        
        // Aplicar filtro de quantidade de d√≠gitos
        if (qtdDigitosFilter) {
            filteredResults = filteredResults.filter(
                result => result.contagem_digitos == parseInt(qtdDigitosFilter)
            );
        }
        
        // Aplicar filtro de d√≠gito espec√≠fico
        if (digitoEspecificoFilter) {
            filteredResults = filteredResults.filter(
                result => result.digitos_ordenados.includes(digitoEspecificoFilter)
            );
        }
        
        // Renderizar resultados filtrados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para limpar filtros
    function limparFiltros() {
        document.getElementById('qtdDigitosFilter').value = '';
        document.getElementById('digitoEspecificoFilter').value = '';
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para renderizar a an√°lise de combina√ß√µes
    function renderCombinationAnalysis() {
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        
        // T√≠tulo da se√ß√£o
        const title = document.createElement('h3');
        title.textContent = 'An√°lise de Combina√ß√µes de D√≠gitos';
        combinationAnalysisDiv.appendChild(title);
        
        // 1. Combina√ß√µes mais frequentes
        const combinacoesFrequentesTitle = document.createElement('h4');
        combinacoesFrequentesTitle.textContent = 'Combina√ß√µes Mais Frequentes';
        combinationAnalysisDiv.appendChild(combinacoesFrequentesTitle);
        
        const combinacoesTable = document.createElement('table');
        combinacoesTable.className = 'combinations-table';
        
		// Cabe√ßalho da tabela
		const headerRow = document.createElement('tr');
		[
			'Combina√ß√£o', 
			'Qtd. D√≠gitos', 
			'Frequ√™ncia', 
			'Detalhes'
		].forEach(text => {
			const th = document.createElement('th');
			th.textContent = text;
			headerRow.appendChild(th);
		});        combinacoesTable.appendChild(headerRow);
        
        // Dados da tabela
        combinationStats.combinacoesFrequentes.forEach(combo => {
            const row = document.createElement('tr');
            
            // Combina√ß√£o
            const tdCombo = document.createElement('td');
            tdCombo.textContent = combo.digitos.join(',');
            row.appendChild(tdCombo);
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = combo.quantidade;
            row.appendChild(tdQtd);
            
            // Frequ√™ncia (n√∫mero de concursos)
            const tdFreq = document.createElement('td');
            tdFreq.textContent = combo.concursos.length;
            row.appendChild(tdFreq);
            
            // Bot√£o para ver detalhes
            const tdDetails = document.createElement('td');
            const detailsBtn = document.createElement('button');
            detailsBtn.textContent = 'Ver Detalhes';
            detailsBtn.className = 'details-button';
            detailsBtn.onclick = () => {
                mostrarDetalhesCombinacao(combo);
            };
            tdDetails.appendChild(detailsBtn);
            row.appendChild(tdDetails);
            
            combinacoesTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(combinacoesTable);
        
        // 2. Resumo por quantidade de d√≠gitos
        const resumoQtdTitle = document.createElement('h4');
        resumoQtdTitle.textContent = 'Resumo por Quantidade de D√≠gitos';
        combinationAnalysisDiv.appendChild(resumoQtdTitle);
        
        const resumoTable = document.createElement('table');
        resumoTable.className = 'summary-table';
        
        // Cabe√ßalho da tabela
        const resumoHeader = document.createElement('tr');
        ['Qtd. D√≠gitos', 'N√∫mero de Sorteios', 'Porcentagem'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            resumoHeader.appendChild(th);
        });
        resumoTable.appendChild(resumoHeader);
        
        // Dados da tabela
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const row = document.createElement('tr');
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = qtd;
            row.appendChild(tdQtd);
            
            // N√∫mero de sorteios
            const count = combinationStats.porQuantidade[qtd].length;
            const tdCount = document.createElement('td');
            tdCount.textContent = count;
            row.appendChild(tdCount);
            
            // Porcentagem
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            const tdPercentage = document.createElement('td');
            tdPercentage.textContent = `${percentage}%`;
            row.appendChild(tdPercentage);
            
            resumoTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(resumoTable);
    }
    
    // Fun√ß√£o para mostrar detalhes de uma combina√ß√£o
    function mostrarDetalhesCombinacao(combo) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        // Fechar modal
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-button';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = () => {
            document.body.removeChild(modal);
        };
        
        // T√≠tulo
        const title = document.createElement('h3');
        title.textContent = `Detalhes da Combina√ß√£o: ${combo.digitos.join(',')}`;
        
        // Informa√ß√µes b√°sicas
        const infoDiv = document.createElement('div');
        infoDiv.className = 'combo-info';
        
        infoDiv.innerHTML = `
            <p><strong>Quantidade de d√≠gitos:</strong> ${combo.quantidade}</p>
            <p><strong>Aparece em ${combo.concursos.length} concursos:</strong> ${combo.concursos.join(', ')}</p>
            <p><strong>M√©dia de intervalo:</strong> ${combo.mediaIntervalos || '-'} concursos</p>
            <p><strong>Menor intervalo:</strong> ${combo.menorIntervalo || '-'} concursos</p>
            <p><strong>Maior intervalo:</strong> ${combo.maiorIntervalo || '-'} concursos</p>
            <p><strong>√öltimo intervalo:</strong> ${combo.ultimoIntervalo || '-'} concursos</p>
        `;
        
        // Intervalos entre concursos
        if (combo.intervalos && combo.intervalos.length > 0) {
            const intervalosDiv = document.createElement('div');
            intervalosDiv.className = 'intervalos-info';
            
            const intervalosTitle = document.createElement('h4');
            intervalosTitle.textContent = 'Intervalos entre Concursos';
            intervalosDiv.appendChild(intervalosTitle);
            
            const intervalosTable = document.createElement('table');
            intervalosTable.className = 'intervalos-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['De Concurso', 'Para Concurso', 'Intervalo'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            intervalosTable.appendChild(headerRow);
            
            // Dados de intervalos
            for (let i = 1; i < combo.concursos.length; i++) {
                const row = document.createElement('tr');
                
                // De concurso
                const tdDe = document.createElement('td');
                tdDe.textContent = combo.concursos[i-1];
                row.appendChild(tdDe);
                
                // Para concurso
                const tdPara = document.createElement('td');
                tdPara.textContent = combo.concursos[i];
                row.appendChild(tdPara);
                
                // Intervalo
                const tdIntervalo = document.createElement('td');
                tdIntervalo.textContent = combo.concursos[i] - combo.concursos[i-1];
                row.appendChild(tdIntervalo);
                
                intervalosTable.appendChild(row);
            }
            
            intervalosDiv.appendChild(intervalosTable);
            infoDiv.appendChild(intervalosDiv);
        }
        
        // Combina√ß√µes similares
        const similaresDiv = document.createElement('div');
        similaresDiv.className = 'similares-info';
        
        if (combo.similares && combo.similares.length > 0) {
            const similaresTitle = document.createElement('h4');
            similaresTitle.textContent = 'Combina√ß√µes Similares';
            similaresDiv.appendChild(similaresTitle);
            
            const similaresTable = document.createElement('table');
            similaresTable.className = 'similares-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['D√≠gitos Comuns', 'D√≠gitos Diferentes', 'Aparece em', 'Frequ√™ncia'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            similaresTable.appendChild(headerRow);
            
            // Dados de combina√ß√µes similares
            combo.similares.forEach(similar => {
                const row = document.createElement('tr');
                
                // D√≠gitos comuns
                const tdComuns = document.createElement('td');
                tdComuns.textContent = similar.digitosComuns.join(',');
                row.appendChild(tdComuns);
                
                // D√≠gitos diferentes
                const tdDiferentes = document.createElement('td');
                tdDiferentes.innerHTML = `
                    <span class="diferencas">
                        <span class="de">${similar.digitosDiferentes.de.join(',') || '-'}</span> ‚Üí
                        <span class="para">${similar.digitosDiferentes.para.join(',') || '-'}</span>
                    </span>
                `;
                row.appendChild(tdDiferentes);
                
                // Aparece em
                const tdConcursos = document.createElement('td');
                tdConcursos.textContent = similar.concursos.slice(0, 5).join(', ');
                if (similar.concursos.length > 5) {
                    tdConcursos.textContent += ` (+ ${similar.concursos.length - 5} outros)`;
                }
                row.appendChild(tdConcursos);
                
                // Frequ√™ncia
                const tdFreq = document.createElement('td');
                tdFreq.textContent = similar.concursos.length;
                row.appendChild(tdFreq);
                
                similaresTable.appendChild(row);
            });
            
            similaresDiv.appendChild(similaresTable);
        } else {
            similaresDiv.innerHTML = '<p>Nenhuma combina√ß√£o similar encontrada.</p>';
        }
        
        // Adicionar todos os elementos ao modal
        modalContent.appendChild(closeBtn);
        modalContent.appendChild(title);
        modalContent.appendChild(infoDiv);
        modalContent.appendChild(similaresDiv);
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fechar o modal ao clicar fora dele
        window.onclick = (event) => {
            if (event.target === modal) {
                document.body.removeChild(modal);
            }
        };
    }
    
    // Fun√ß√£o para renderizar os resultados na tabela
    function renderResults(results) {
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = '';
        
        // Atualizar informa√ß√£o sobre resultados filtrados
        const resultsInfoDiv = document.getElementById('resultadosInfo');
        if (!resultsInfoDiv) {
            const infoDiv = document.createElement('div');
            infoDiv.id = 'resultadosInfo';
            infoDiv.className = 'results-info';
            infoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
            
            // Inserir antes da tabela
            const tableContainer = document.getElementById('diaDeSorteResults').parentNode;
            tableContainer.insertBefore(infoDiv, document.getElementById('diaDeSorteResults'));
        } else {
            resultsInfoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
        }
        
        results.forEach(result => {
            const row = tableBody.insertRow();
            
            // Formatar data
            const dataParts = result.data ? result.data.split('/') : ['', '', ''];
            const dataFormatada = dataParts.length === 3 ? `${dataParts[0]}/${dataParts[1]}/${dataParts[2]}` : result.data;
            
            row.innerHTML = `
                <td>${result.concurso}</td>
                <td>${dataFormatada}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
                <td>
                    <button class="copy-button" data-digits="${result.digitos_para_copia}">
                        Copiar
                    </button>
                </td>
            `;
        });
        
        // Adicionar event listeners para os bot√µes de c√≥pia
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', function() {
                const digits = this.getAttribute('data-digits');
                navigator.clipboard.writeText(digits)
                    .then(() => {
                        // Feedback visual para o usu√°rio
                        const originalText = this.textContent;
                        this.textContent = 'Copiado!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Erro ao copiar os d√≠gitos.');
                    });
            });
        });
    }
    
    // Fun√ß√£o para renderizar estat√≠sticas dos d√≠gitos
    function renderDigitStats(stats) {
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        
        // Ordenar os d√≠gitos por frequ√™ncia (do maior para o menor)
        const sortedDigits = Object.entries(stats).sort((a, b) => b[1] - a[1]);
        
        // Criar visualiza√ß√£o da frequ√™ncia de d√≠gitos - Ordenada por frequ√™ncia
        sortedDigits.forEach(([digit, count]) => {
            const digitBox = document.createElement('div');
            digitBox.className = 'digit-box';
            digitBox.innerHTML = `${digit}<span class="digit-count">${count}</span>`;
            digitFrequencyDiv.appendChild(digitBox);
        });
        
        // Criar gr√°fico de barras para frequ√™ncia de d√≠gitos - Ordenado por frequ√™ncia
        const maxCount = Math.max(...Object.values(stats));
        const chartHtml = sortedDigits.map(([digit, count]) => {
            const percentage = (count / maxCount) * 100;
            return `
                <div style="margin: 10px 0;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 20px; text-align: center;">${digit}</div>
                        <div style="flex-grow: 1; margin: 0 10px;">
                            <div style="background-color: #4CAF50; height: 20px; width: ${percentage}%;"></div>
                        </div>
                        <div style="width: 40px; text-align: right;">${count}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        digitChartDiv.innerHTML = chartHtml;
    }
    
// Fun√ß√µes para download
 function downloadCSV() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criando uma tabela HTML que o Excel pode importar corretamente
    let excelContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">';
    excelContent += '<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>D√≠gitos Dia de Sorte</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->';
    excelContent += '<style>th { background-color: #000000; color: #ffffff; text-align: left; font-weight: bold; } td { text-align: left; } .concurso { mso-number-format:"0"; }</style>';
    excelContent += '</head>';
    excelContent += '<body><table border="1">';
    
    // Adicionar cabe√ßalho com acentos corretos e formata√ß√£o (fundo preto, fonte branca)
    excelContent += '<tr>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Concurso</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Data</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Dezenas</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos Ordenados</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Qtd. D√≠gitos</th>';
    excelContent += '</tr>';
    
    // Adicionar dados (alinhados √† esquerda)
    filteredResults.forEach(result => {
        excelContent += '<tr>';
        excelContent += `<td class="concurso" style="text-align: left;">${result.concurso}</td>`;
        excelContent += `<td style="text-align: left;">${result.data}</td>`;
        excelContent += `<td style="text-align: left;">${result.dezenas.join(' - ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_para_exibicao || result.digitos.join(' ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_ordenados.join(',')}</td>`;
        excelContent += `<td style="text-align: left;">${result.contagem_digitos}</td>`;
        excelContent += '</tr>';
    });
    
    excelContent += '</table></body></html>';
    
    // Criar o blob com tipo MIME para Excel
    const blob = new Blob([excelContent], {type: 'application/vnd.ms-excel'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.xls';
    link.click();
}
   
function downloadJSON() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criar conte√∫do HTML formatado
    let htmlContent = `
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>An√°lise de D√≠gitos do Dia de Sorte</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f0f8ff;
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 5px;
            }
            h1, h2, h3 {
                color: #006400;
                text-align: center;
            }
            .section {
                margin-bottom: 30px;
                padding: 15px;
                background-color: #f9f9f9;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
            }
            th {
                background-color: #000000;
                color: white;
                padding: 10px;
                text-align: left;
            }
            td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }
            tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            .digit-box {
                display: inline-block;
                width: 40px;
                height: 40px;
                line-height: 40px;
                text-align: center;
                margin: 5px;
                background-color: #4CAF50;
                color: white;
                border-radius: 50%;
                font-weight: bold;
            }
            .digit-count {
                font-size: 12px;
                color: #666;
                display: block;
                text-align: center;
            }
            .footer {
                text-align: center;
                margin-top: 20px;
                font-size: 12px;
                color: #666;
                padding: 10px;
                border-top: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>An√°lise de D√≠gitos do Dia de Sorte</h1>
            
            <div class="section">
                <h2>Estat√≠sticas de Frequ√™ncia dos D√≠gitos</h2>
                <div style="display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
    `;
    
    // Adicionar estat√≠sticas de d√≠gitos
    const sortedDigits = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
    sortedDigits.forEach(([digit, count]) => {
        htmlContent += `
            <div class="digit-box">${digit}
                <span class="digit-count">${count} vezes</span>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
                
                <h3>Gr√°fico de Frequ√™ncia</h3>
                <div style="padding: 15px;">
    `;
    
    // Adicionar gr√°fico de barras simples
    const maxCount = Math.max(...Object.values(digitStats));
    sortedDigits.forEach(([digit, count]) => {
        const percentage = (count / maxCount) * 100;
        htmlContent += `
            <div style="margin: 10px 0; display: flex; align-items: center;">
                <div style="width: 30px; text-align: center; font-weight: bold;">${digit}</div>
                <div style="flex-grow: 1; margin: 0 10px;">
                    <div style="background-color: #4CAF50; height: 24px; width: ${percentage}%;"></div>
                </div>
                <div style="width: 60px; text-align: right;">${count}</div>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
            </div>
            
            <div class="section">
                <h2>Resumo por Quantidade de D√≠gitos</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Qtd. D√≠gitos</th>
                            <th>N√∫mero de Sorteios</th>
                            <th>Porcentagem</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resumo por quantidade de d√≠gitos
    const qtdKeys = Object.keys(combinationStats.porQuantidade)
        .sort((a, b) => parseInt(a) - parseInt(b));
    
    qtdKeys.forEach(qtd => {
        const count = combinationStats.porQuantidade[qtd].length;
        const percentage = ((count / allResults.length) * 100).toFixed(2);
        htmlContent += `
            <tr>
                <td>${qtd}</td>
                <td>${count}</td>
                <td>${percentage}%</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Combina√ß√µes Mais Frequentes</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Combina√ß√£o</th>
                            <th>Qtd. D√≠gitos</th>
                            <th>Frequ√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar combina√ß√µes mais frequentes
    combinationStats.combinacoesFrequentes.slice(0, 10).forEach(combo => {
        htmlContent += `
            <tr>
                <td>${combo.digitos.join(',')}</td>
                <td>${combo.quantidade}</td>
                <td>${combo.concursos.length}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Resultados Detalhados</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Concurso</th>
                            <th>Data</th>
                            <th>Dezenas</th>
                            <th>D√≠gitos</th>
                            <th>D√≠gitos Ordenados</th>
                            <th>Qtd. D√≠gitos</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resultados detalhados
    filteredResults.forEach(result => {
        htmlContent += `
            <tr>
                <td>${result.concurso}</td>
                <td>${result.data || ''}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="footer">
                <p>Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                <p>Total de resultados analisados: ${allResults.length}</p>
            </div>
        </div>
    </body>
    </html>
    `;
    
    // Criar o blob com tipo MIME para HTML
    const blob = new Blob([htmlContent], {type: 'text/html;charset=utf-8'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.html';
    link.click();
}    
    function downloadTXT() {
        if (allResults.length === 0) {
            alert('Carregue os resultados primeiro!');
            return;
        }
        
        let txtContent = "An√°lise de D√≠gitos do Dia de Sorte\n\n";
        
        // Adicionar estat√≠sticas - ordenar por frequ√™ncia para o arquivo TXT tamb√©m
        txtContent += "ESTAT√çSTICAS DE FREQU√äNCIA DOS D√çGITOS (ORDEM DECRESCENTE):\n";
        const sortedStats = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
        sortedStats.forEach(([digit, count]) => {
            txtContent += `D√≠gito ${digit}: ${count} ocorr√™ncias\n`;
        });
        
        // Adicionar resumo de combina√ß√µes
        txtContent += "\n\nRESUMO POR QUANTIDADE DE D√çGITOS:\n";
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const count = combinationStats.porQuantidade[qtd].length;
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            txtContent += `${qtd} d√≠gitos: ${count} sorteios (${percentage}%)\n`;
        });
        
        // Adicionar combina√ß√µes mais frequentes
        txtContent += "\n\nCOMBINA√á√ïES MAIS FREQUENTES:\n";
        combinationStats.combinacoesFrequentes.slice(0, 5).forEach((combo, index) => {
            txtContent += `${index + 1}. Combina√ß√£o [${combo.digitos.join(',')}]: Aparece em ${combo.concursos.length} sorteios\n`;
        });
        
        txtContent += "\n\nRESULTADOS DETALHADOS:\n";
        filteredResults.forEach(result => {
            const digitos = result.digitos_para_exibicao || result.digitos.join(' ');
            const digitosOrdenados = result.digitos_ordenados.join(',');
            txtContent += `Concurso: ${result.concurso} | Data: ${result.data} | Dezenas: ${result.dezenas.join('-')} | `;
            txtContent += `D√≠gitos: ${digitos} | Ordenados: ${digitosOrdenados} | `;
            txtContent += `Quantidade: ${result.contagem_digitos}\n`;
        });
        
        // Criar o blob com tipo MIME para texto
        const blob = new Blob([txtContent], {type: 'text/plain;charset=utf-8'});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = 'analise_digitos_diadesorte.txt';
        link.click();
    }
	
	// Fun√ß√£o auxiliar para download de arquivos
	function downloadFile(content, fileName, type) {
    const blob = new Blob([content], { type });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    link.click();
    console.log("Download iniciado:", fileName);
	}
	
});

document.addEventListener('DOMContentLoaded', function() {
    const loadButton = document.getElementById('loadButton');
    const downloadCSVButton = document.getElementById('downloadCSV');
    const downloadJSONButton = document.getElementById('downloadJSON');
    const downloadTXTButton = document.getElementById('downloadTXT');
    
    let allResults = [];
    let filteredResults = [];
    let digitStats = {};
    let combinationStats = {};
    
    // Registrar eventos de clique
    loadButton.addEventListener('click', fetchDigitosResults);
    downloadCSVButton.addEventListener('click', downloadCSV);
    downloadJSONButton.addEventListener('click', downloadJSON);
    downloadTXTButton.addEventListener('click', downloadTXT);
	
	
	// Chamar fetchDigitosResults automaticamente quando a p√°gina carregar
    fetchDigitosResults();
    
    // Fun√ß√£o para buscar os resultados - com tratamento de erros melhorado
    async function fetchDigitosResults() {
		// No in√≠cio da fun√ß√£o fetchDigitosResults
		console.log("Fun√ß√£o fetchDigitosResults iniciada");
		
		const loadButton = document.getElementById('loadButton');

		// Desabilitar o bot√£o enquanto carrega
		if (loadButton) {
			loadButton.disabled = true;
			loadButton.style.opacity = '0.6';
			loadButton.style.cursor = 'not-allowed';
		}
		
        const loadingMessage = document.getElementById('loadingMessage');
        const completedMessage = document.getElementById('completedMessage');
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        const filterContainerDiv = document.getElementById('filterContainer');
        
        loadingMessage.style.display = 'block';
        completedMessage.style.display = 'none';
        tableBody.innerHTML = '';
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        combinationAnalysisDiv.innerHTML = '';
        filterContainerDiv.innerHTML = '';
        
        try {
            console.log("Iniciando fetch de dados...");
            const response = await fetch('/api/digitos');
            console.log("Status da resposta:", response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error("Erro na resposta:", errorText);
                throw new Error(`Erro ao acessar a API. Status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log("Dados recebidos:", data);
            
            if (data.resultados && Array.isArray(data.resultados)) {
                allResults = data.resultados;
				// Compartilhar resultados no escopo global
				window.allResults = allResults;
				window.digitStats = digitStats;
				
				
                filteredResults = [...allResults]; // Inicialmente, todos os resultados
                digitStats = data.frequencia_digitos;
                
                // Analisar combina√ß√µes de d√≠gitos
                analisarCombinacoes(allResults);
                
                // Renderizar tudo
                renderFilterOptions();
                renderResults(filteredResults);
                renderDigitStats(digitStats);
                renderCombinationAnalysis();
            } else {
                console.error("Formato inv√°lido:", data);
                throw new Error('Formato de dados inv√°lido.');
            }
        } catch (error) {
            console.error("Erro detalhado:", error);
            alert('Erro ao buscar os resultados: ' + error.message);
        } finally {
            loadingMessage.style.display = 'none';
            completedMessage.style.display = 'block';
			
			// Reabilitar o bot√£o quando o carregamento terminar
			if (loadButton) {
				loadButton.disabled = false;
				loadButton.style.opacity = '1';
				loadButton.style.cursor = 'pointer';
			}
        }
    }
    
    // Fun√ß√£o para analisar combina√ß√µes de d√≠gitos
    function analisarCombinacoes(results) {
        combinationStats = {
            porQuantidade: {}, // Agrupar por quantidade de d√≠gitos
            combinacoesFrequentes: {}, // Combina√ß√µes mais frequentes
            digitosExclusivos: {} // D√≠gitos que aparecem apenas em alguns sorteios
        };
        
        // Agrupar resultados por quantidade de d√≠gitos
        results.forEach(result => {
            const qtd = result.contagem_digitos;
            if (!combinationStats.porQuantidade[qtd]) {
                combinationStats.porQuantidade[qtd] = [];
            }
            combinationStats.porQuantidade[qtd].push(result);
        });
        
        // Encontrar combina√ß√µes frequentes
        results.forEach(result => {
            const combinacao = result.digitos_ordenados.join(',');
            if (!combinationStats.combinacoesFrequentes[combinacao]) {
                combinationStats.combinacoesFrequentes[combinacao] = {
                    combinacao: combinacao,
                    concursos: [],
                    digitos: result.digitos_ordenados,
                    quantidade: result.contagem_digitos
                };
            }
            combinationStats.combinacoesFrequentes[combinacao].concursos.push(result.concurso);
        });
        
        // Ordenar combina√ß√µes por frequ√™ncia
        combinationStats.combinacoesFrequentes = Object.values(combinationStats.combinacoesFrequentes)
            .sort((a, b) => b.concursos.length - a.concursos.length);
        
        // Analisar similaridades e diferen√ßas entre combina√ß√µes
        for (let i = 0; i < combinationStats.combinacoesFrequentes.length; i++) {
            const combo = combinationStats.combinacoesFrequentes[i];
            combo.similares = [];
            
            for (let j = 0; j < combinationStats.combinacoesFrequentes.length; j++) {
                if (i === j) continue;
                
                const outroCombo = combinationStats.combinacoesFrequentes[j];
                
                // Comparar os d√≠gitos
                const digitosCombo = new Set(combo.digitos);
                const digitosOutroCombo = new Set(outroCombo.digitos);
                
                // Diferen√ßas
                const digitosExclusivosCombo1 = [...digitosCombo].filter(d => !digitosOutroCombo.has(d));
                const digitosExclusivosCombo2 = [...digitosOutroCombo].filter(d => !digitosCombo.has(d));
                
                // Interse√ß√£o
                const digitosComuns = [...digitosCombo].filter(d => digitosOutroCombo.has(d));
                
                // Se tem similaridade significativa (mais de 70% em comum)
                if (digitosComuns.length >= combo.digitos.length * 0.7) {
                    combo.similares.push({
                        concursos: outroCombo.concursos,
                        digitosComuns: digitosComuns,
                        digitosDiferentes: {
                            de: digitosExclusivosCombo1,
                            para: digitosExclusivosCombo2
                        }
                    });
                }
            }
            
            // Limitar a 5 combina√ß√µes similares por combina√ß√£o
            combo.similares = combo.similares.slice(0, 5);
        }
        
        // Calcular estat√≠sticas adicionais para as combina√ß√µes frequentes
        combinationStats.combinacoesFrequentes.forEach(combo => {
            // Ordenar concursos
            combo.concursos.sort((a, b) => a - b);
            
            // Calcular intervalos
            const intervalos = [];
            for (let i = 1; i < combo.concursos.length; i++) {
                intervalos.push(combo.concursos[i] - combo.concursos[i-1]);
            }
            
            if (intervalos.length > 0) {
                combo.intervalos = intervalos;
                combo.mediaIntervalos = Math.round(intervalos.reduce((a, b) => a + b, 0) / intervalos.length);
                combo.menorIntervalo = Math.min(...intervalos);
                combo.maiorIntervalo = Math.max(...intervalos);
                combo.ultimoIntervalo = intervalos[intervalos.length - 1];
            }
        });
        
        // Limitar as combina√ß√µes mais frequentes √†s top 10
        combinationStats.combinacoesFrequentes = combinationStats.combinacoesFrequentes.slice(0, 10);
        
        // Compartilhar resultados analisados no escopo global para uso pelo resumo-simples.js
        window.resultadosAnalisados = {
            combinacoesOrdenadas: combinationStats.combinacoesFrequentes,
            mediaGeral: combinationStats.combinacoesFrequentes.reduce((acc, c) => acc + (c.mediaIntervalos || 0), 0) / 
                        combinationStats.combinacoesFrequentes.filter(c => c.mediaIntervalos).length
        };
    }
    
    // Fun√ß√£o para renderizar op√ß√µes de filtro
    function renderFilterOptions() {
        const filterContainerDiv = document.getElementById('filterContainer');
        
        // Clear filter container
        filterContainerDiv.innerHTML = '';
        
        // Criar o t√≠tulo
        const filterTitle = document.createElement('h3');
        filterTitle.textContent = 'Filtros';
        filterContainerDiv.appendChild(filterTitle);
        
        // Criar container de filtros
        const filtersDiv = document.createElement('div');
        filtersDiv.className = 'filters';
        
        // 1. Filtro por quantidade de d√≠gitos
        const qtdDigitosDiv = document.createElement('div');
        qtdDigitosDiv.className = 'filter-item';
        
        const qtdDigitosLabel = document.createElement('label');
        qtdDigitosLabel.textContent = 'Qtd. D√≠gitos: ';
        
        const qtdDigitosSelect = document.createElement('select');
        qtdDigitosSelect.id = 'qtdDigitosFilter';
        
        // Op√ß√£o "Todos"
        const optionTodos = document.createElement('option');
        optionTodos.value = '';
        optionTodos.textContent = 'Todos';
        qtdDigitosSelect.appendChild(optionTodos);
        
        // Quantidades dispon√≠veis
        const quantidades = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        quantidades.forEach(qtd => {
            const option = document.createElement('option');
            option.value = qtd;
            option.textContent = `${qtd} d√≠gitos (${combinationStats.porQuantidade[qtd].length} resultados)`;
            qtdDigitosSelect.appendChild(option);
        });
        
        qtdDigitosDiv.appendChild(qtdDigitosLabel);
        qtdDigitosDiv.appendChild(qtdDigitosSelect);
        
        // 2. Filtro por d√≠gito espec√≠fico
        const digitoEspecificoDiv = document.createElement('div');
        digitoEspecificoDiv.className = 'filter-item';
        
        const digitoEspecificoLabel = document.createElement('label');
        digitoEspecificoLabel.textContent = 'Cont√©m D√≠gito: ';
        
        const digitoEspecificoSelect = document.createElement('select');
        digitoEspecificoSelect.id = 'digitoEspecificoFilter';
        
        // Op√ß√£o "Todos"
        const optionTodosDigitos = document.createElement('option');
        optionTodosDigitos.value = '';
        optionTodosDigitos.textContent = 'Todos';
        digitoEspecificoSelect.appendChild(optionTodosDigitos);
        
        // Listar todos os d√≠gitos ordenados por frequ√™ncia
        const digitosPorFrequencia = Object.entries(digitStats)
            .sort((a, b) => b[1] - a[1]);
        
        digitosPorFrequencia.forEach(([digito, frequencia]) => {
            const option = document.createElement('option');
            option.value = digito;
            option.textContent = `D√≠gito ${digito} (${frequencia} ocorr√™ncias)`;
            digitoEspecificoSelect.appendChild(option);
        });
        
        digitoEspecificoDiv.appendChild(digitoEspecificoLabel);
        digitoEspecificoDiv.appendChild(digitoEspecificoSelect);
        
        // 3. Bot√£o de aplicar filtro
        const aplicarFiltroBtn = document.createElement('button');
        aplicarFiltroBtn.textContent = 'Aplicar Filtros';
        aplicarFiltroBtn.className = 'button';
        aplicarFiltroBtn.onclick = aplicarFiltros;
        
        // 4. Bot√£o de limpar filtro
        const limparFiltroBtn = document.createElement('button');
        limparFiltroBtn.textContent = 'Limpar Filtros';
        limparFiltroBtn.className = 'button';
        limparFiltroBtn.onclick = limparFiltros;
        
        // Adicionar todos os elementos ao container
        filtersDiv.appendChild(qtdDigitosDiv);
        filtersDiv.appendChild(digitoEspecificoDiv);
        filtersDiv.appendChild(aplicarFiltroBtn);
        filtersDiv.appendChild(limparFiltroBtn);
        
        filterContainerDiv.appendChild(filtersDiv);
    }
    
    // Fun√ß√£o para aplicar filtros
    function aplicarFiltros() {
        const qtdDigitosFilter = document.getElementById('qtdDigitosFilter').value;
        const digitoEspecificoFilter = document.getElementById('digitoEspecificoFilter').value;
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        
        // Aplicar filtro de quantidade de d√≠gitos
        if (qtdDigitosFilter) {
            filteredResults = filteredResults.filter(
                result => result.contagem_digitos == parseInt(qtdDigitosFilter)
            );
        }
        
        // Aplicar filtro de d√≠gito espec√≠fico
        if (digitoEspecificoFilter) {
            filteredResults = filteredResults.filter(
                result => result.digitos_ordenados.includes(digitoEspecificoFilter)
            );
        }
        
        // Renderizar resultados filtrados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para limpar filtros
    function limparFiltros() {
        document.getElementById('qtdDigitosFilter').value = '';
        document.getElementById('digitoEspecificoFilter').value = '';
        
        filteredResults = [...allResults]; // Reiniciar com todos os resultados
        renderResults(filteredResults);
        
        // Atualizar mensagem de resultados
        const resultadosInfo = document.getElementById('resultadosInfo');
        if (resultadosInfo) {
            resultadosInfo.textContent = `Exibindo ${filteredResults.length} de ${allResults.length} resultados`;
        }
    }
    
    // Fun√ß√£o para renderizar a an√°lise de combina√ß√µes
    function renderCombinationAnalysis() {
        const combinationAnalysisDiv = document.getElementById('combinationAnalysis');
        
        // T√≠tulo da se√ß√£o
        const title = document.createElement('h3');
        title.textContent = 'An√°lise de Combina√ß√µes de D√≠gitos';
        combinationAnalysisDiv.appendChild(title);
        
        // 1. Combina√ß√µes mais frequentes
        const combinacoesFrequentesTitle = document.createElement('h4');
        combinacoesFrequentesTitle.textContent = 'Combina√ß√µes Mais Frequentes';
        combinationAnalysisDiv.appendChild(combinacoesFrequentesTitle);
        
        const combinacoesTable = document.createElement('table');
        combinacoesTable.className = 'combinations-table';
        
		// Cabe√ßalho da tabela
		const headerRow = document.createElement('tr');
		[
			'Combina√ß√£o', 
			'Qtd. D√≠gitos', 
			'Frequ√™ncia', 
			'Detalhes'
		].forEach(text => {
			const th = document.createElement('th');
			th.textContent = text;
			headerRow.appendChild(th);
		});        combinacoesTable.appendChild(headerRow);
        
        // Dados da tabela
        combinationStats.combinacoesFrequentes.forEach(combo => {
            const row = document.createElement('tr');
            
            // Combina√ß√£o
            const tdCombo = document.createElement('td');
            tdCombo.textContent = combo.digitos.join(',');
            row.appendChild(tdCombo);
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = combo.quantidade;
            row.appendChild(tdQtd);
            
            // Frequ√™ncia (n√∫mero de concursos)
            const tdFreq = document.createElement('td');
            tdFreq.textContent = combo.concursos.length;
            row.appendChild(tdFreq);
            
            // Bot√£o para ver detalhes
            const tdDetails = document.createElement('td');
            const detailsBtn = document.createElement('button');
            detailsBtn.textContent = 'Ver Detalhes';
            detailsBtn.className = 'details-button';
            detailsBtn.onclick = () => {
                mostrarDetalhesCombinacao(combo);
            };
            tdDetails.appendChild(detailsBtn);
            row.appendChild(tdDetails);
            
            combinacoesTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(combinacoesTable);
        
        // 2. Resumo por quantidade de d√≠gitos
        const resumoQtdTitle = document.createElement('h4');
        resumoQtdTitle.textContent = 'Resumo por Quantidade de D√≠gitos';
        combinationAnalysisDiv.appendChild(resumoQtdTitle);
        
        const resumoTable = document.createElement('table');
        resumoTable.className = 'summary-table';
        
        // Cabe√ßalho da tabela
        const resumoHeader = document.createElement('tr');
        ['Qtd. D√≠gitos', 'N√∫mero de Sorteios', 'Porcentagem'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            resumoHeader.appendChild(th);
        });
        resumoTable.appendChild(resumoHeader);
        
        // Dados da tabela
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const row = document.createElement('tr');
            
            // Quantidade de d√≠gitos
            const tdQtd = document.createElement('td');
            tdQtd.textContent = qtd;
            row.appendChild(tdQtd);
            
            // N√∫mero de sorteios
            const count = combinationStats.porQuantidade[qtd].length;
            const tdCount = document.createElement('td');
            tdCount.textContent = count;
            row.appendChild(tdCount);
            
            // Porcentagem
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            const tdPercentage = document.createElement('td');
            tdPercentage.textContent = `${percentage}%`;
            row.appendChild(tdPercentage);
            
            resumoTable.appendChild(row);
        });
        
        combinationAnalysisDiv.appendChild(resumoTable);
    }
    
    // Fun√ß√£o para mostrar detalhes de uma combina√ß√£o
    function mostrarDetalhesCombinacao(combo) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        // Fechar modal
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-button';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = () => {
            document.body.removeChild(modal);
        };
        
        // T√≠tulo
        const title = document.createElement('h3');
        title.textContent = `Detalhes da Combina√ß√£o: ${combo.digitos.join(',')}`;
        
        // Informa√ß√µes b√°sicas
        const infoDiv = document.createElement('div');
        infoDiv.className = 'combo-info';
        
        infoDiv.innerHTML = `
            <p><strong>Quantidade de d√≠gitos:</strong> ${combo.quantidade}</p>
            <p><strong>Aparece em ${combo.concursos.length} concursos:</strong> ${combo.concursos.join(', ')}</p>
            <p><strong>M√©dia de intervalo:</strong> ${combo.mediaIntervalos || '-'} concursos</p>
            <p><strong>Menor intervalo:</strong> ${combo.menorIntervalo || '-'} concursos</p>
            <p><strong>Maior intervalo:</strong> ${combo.maiorIntervalo || '-'} concursos</p>
            <p><strong>√öltimo intervalo:</strong> ${combo.ultimoIntervalo || '-'} concursos</p>
        `;
        
        // Intervalos entre concursos
        if (combo.intervalos && combo.intervalos.length > 0) {
            const intervalosDiv = document.createElement('div');
            intervalosDiv.className = 'intervalos-info';
            
            const intervalosTitle = document.createElement('h4');
            intervalosTitle.textContent = 'Intervalos entre Concursos';
            intervalosDiv.appendChild(intervalosTitle);
            
            const intervalosTable = document.createElement('table');
            intervalosTable.className = 'intervalos-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['De Concurso', 'Para Concurso', 'Intervalo'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            intervalosTable.appendChild(headerRow);
            
            // Dados de intervalos
            for (let i = 1; i < combo.concursos.length; i++) {
                const row = document.createElement('tr');
                
                // De concurso
                const tdDe = document.createElement('td');
                tdDe.textContent = combo.concursos[i-1];
                row.appendChild(tdDe);
                
                // Para concurso
                const tdPara = document.createElement('td');
                tdPara.textContent = combo.concursos[i];
                row.appendChild(tdPara);
                
                // Intervalo
                const tdIntervalo = document.createElement('td');
                tdIntervalo.textContent = combo.concursos[i] - combo.concursos[i-1];
                row.appendChild(tdIntervalo);
                
                intervalosTable.appendChild(row);
            }
            
            intervalosDiv.appendChild(intervalosTable);
            infoDiv.appendChild(intervalosDiv);
        }
        
        // Combina√ß√µes similares
        const similaresDiv = document.createElement('div');
        similaresDiv.className = 'similares-info';
        
        if (combo.similares && combo.similares.length > 0) {
            const similaresTitle = document.createElement('h4');
            similaresTitle.textContent = 'Combina√ß√µes Similares';
            similaresDiv.appendChild(similaresTitle);
            
            const similaresTable = document.createElement('table');
            similaresTable.className = 'similares-table';
            
            // Cabe√ßalho
            const headerRow = document.createElement('tr');
            ['D√≠gitos Comuns', 'D√≠gitos Diferentes', 'Aparece em', 'Frequ√™ncia'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });
            similaresTable.appendChild(headerRow);
            
            // Dados de combina√ß√µes similares
            combo.similares.forEach(similar => {
                const row = document.createElement('tr');
                
                // D√≠gitos comuns
                const tdComuns = document.createElement('td');
                tdComuns.textContent = similar.digitosComuns.join(',');
                row.appendChild(tdComuns);
                
                // D√≠gitos diferentes
                const tdDiferentes = document.createElement('td');
                tdDiferentes.innerHTML = `
                    <span class="diferencas">
                        <span class="de">${similar.digitosDiferentes.de.join(',') || '-'}</span> ‚Üí
                        <span class="para">${similar.digitosDiferentes.para.join(',') || '-'}</span>
                    </span>
                `;
                row.appendChild(tdDiferentes);
                
                // Aparece em
                const tdConcursos = document.createElement('td');
                tdConcursos.textContent = similar.concursos.slice(0, 5).join(', ');
                if (similar.concursos.length > 5) {
                    tdConcursos.textContent += ` (+ ${similar.concursos.length - 5} outros)`;
                }
                row.appendChild(tdConcursos);
                
                // Frequ√™ncia
                const tdFreq = document.createElement('td');
                tdFreq.textContent = similar.concursos.length;
                row.appendChild(tdFreq);
                
                similaresTable.appendChild(row);
            });
            
            similaresDiv.appendChild(similaresTable);
        } else {
            similaresDiv.innerHTML = '<p>Nenhuma combina√ß√£o similar encontrada.</p>';
        }
        
        // Adicionar todos os elementos ao modal
        modalContent.appendChild(closeBtn);
        modalContent.appendChild(title);
        modalContent.appendChild(infoDiv);
        modalContent.appendChild(similaresDiv);
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fechar o modal ao clicar fora dele
        window.onclick = (event) => {
            if (event.target === modal) {
                document.body.removeChild(modal);
            }
        };
    }
    
    // Fun√ß√£o para renderizar os resultados na tabela
    function renderResults(results) {
        const tableBody = document.getElementById('diaDeSorteResults').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = '';
        
        // Atualizar informa√ß√£o sobre resultados filtrados
        const resultsInfoDiv = document.getElementById('resultadosInfo');
        if (!resultsInfoDiv) {
            const infoDiv = document.createElement('div');
            infoDiv.id = 'resultadosInfo';
            infoDiv.className = 'results-info';
            infoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
            
            // Inserir antes da tabela
            const tableContainer = document.getElementById('diaDeSorteResults').parentNode;
            tableContainer.insertBefore(infoDiv, document.getElementById('diaDeSorteResults'));
        } else {
            resultsInfoDiv.textContent = `Exibindo ${results.length} de ${allResults.length} resultados`;
        }
        
        results.forEach(result => {
            const row = tableBody.insertRow();
            
            // Formatar data
            const dataParts = result.data ? result.data.split('/') : ['', '', ''];
            const dataFormatada = dataParts.length === 3 ? `${dataParts[0]}/${dataParts[1]}/${dataParts[2]}` : result.data;
            
            row.innerHTML = `
                <td>${result.concurso}</td>
                <td>${dataFormatada}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
                <td>
                    <button class="copy-button" data-digits="${result.digitos_para_copia}">
                        Copiar
                    </button>
                </td>
            `;
        });
        
        // Adicionar event listeners para os bot√µes de c√≥pia
        document.querySelectorAll('.copy-button').forEach(button => {
            button.addEventListener('click', function() {
                const digits = this.getAttribute('data-digits');
                navigator.clipboard.writeText(digits)
                    .then(() => {
                        // Feedback visual para o usu√°rio
                        const originalText = this.textContent;
                        this.textContent = 'Copiado!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('Erro ao copiar os d√≠gitos.');
                    });
            });
        });
    }
    
    // Fun√ß√£o para renderizar estat√≠sticas dos d√≠gitos
    function renderDigitStats(stats) {
        const digitFrequencyDiv = document.getElementById('digitFrequency');
        const digitChartDiv = document.getElementById('digitChart');
        
        digitFrequencyDiv.innerHTML = '';
        digitChartDiv.innerHTML = '';
        
        // Ordenar os d√≠gitos por frequ√™ncia (do maior para o menor)
        const sortedDigits = Object.entries(stats).sort((a, b) => b[1] - a[1]);
        
        // Criar visualiza√ß√£o da frequ√™ncia de d√≠gitos - Ordenada por frequ√™ncia
        sortedDigits.forEach(([digit, count]) => {
            const digitBox = document.createElement('div');
            digitBox.className = 'digit-box';
            digitBox.innerHTML = `${digit}<span class="digit-count">${count}</span>`;
            digitFrequencyDiv.appendChild(digitBox);
        });
        
        // Criar gr√°fico de barras para frequ√™ncia de d√≠gitos - Ordenado por frequ√™ncia
        const maxCount = Math.max(...Object.values(stats));
        const chartHtml = sortedDigits.map(([digit, count]) => {
            const percentage = (count / maxCount) * 100;
            return `
                <div style="margin: 10px 0;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 20px; text-align: center;">${digit}</div>
                        <div style="flex-grow: 1; margin: 0 10px;">
                            <div style="background-color: #4CAF50; height: 20px; width: ${percentage}%;"></div>
                        </div>
                        <div style="width: 40px; text-align: right;">${count}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        digitChartDiv.innerHTML = chartHtml;
    }
    
// Fun√ß√µes para download
 function downloadCSV() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criando uma tabela HTML que o Excel pode importar corretamente
    let excelContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">';
    excelContent += '<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>D√≠gitos Dia de Sorte</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->';
    excelContent += '<style>th { background-color: #000000; color: #ffffff; text-align: left; font-weight: bold; } td { text-align: left; } .concurso { mso-number-format:"0"; }</style>';
    excelContent += '</head>';
    excelContent += '<body><table border="1">';
    
    // Adicionar cabe√ßalho com acentos corretos e formata√ß√£o (fundo preto, fonte branca)
    excelContent += '<tr>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Concurso</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Data</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Dezenas</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">D√≠gitos Ordenados</th>';
    excelContent += '<th style="background-color: #000000; color: #ffffff;">Qtd. D√≠gitos</th>';
    excelContent += '</tr>';
    
    // Adicionar dados (alinhados √† esquerda)
    filteredResults.forEach(result => {
        excelContent += '<tr>';
        excelContent += `<td class="concurso" style="text-align: left;">${result.concurso}</td>`;
        excelContent += `<td style="text-align: left;">${result.data}</td>`;
        excelContent += `<td style="text-align: left;">${result.dezenas.join(' - ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_para_exibicao || result.digitos.join(' ')}</td>`;
        excelContent += `<td style="text-align: left;">${result.digitos_ordenados.join(',')}</td>`;
        excelContent += `<td style="text-align: left;">${result.contagem_digitos}</td>`;
        excelContent += '</tr>';
    });
    
    excelContent += '</table></body></html>';
    
    // Criar o blob com tipo MIME para Excel
    const blob = new Blob([excelContent], {type: 'application/vnd.ms-excel'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.xls';
    link.click();
}
   
function downloadJSON() {
    if (allResults.length === 0) {
        alert('Carregue os resultados primeiro!');
        return;
    }
    
    // Criar conte√∫do HTML formatado
    let htmlContent = `
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>An√°lise de D√≠gitos do Dia de Sorte</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f0f8ff;
                color: #333;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 5px;
            }
            h1, h2, h3 {
                color: #006400;
                text-align: center;
            }
            .section {
                margin-bottom: 30px;
                padding: 15px;
                background-color: #f9f9f9;
                border-radius: 5px;
                border: 1px solid #ddd;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
            }
            th {
                background-color: #000000;
                color: white;
                padding: 10px;
                text-align: left;
            }
            td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }
            tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            .digit-box {
                display: inline-block;
                width: 40px;
                height: 40px;
                line-height: 40px;
                text-align: center;
                margin: 5px;
                background-color: #4CAF50;
                color: white;
                border-radius: 50%;
                font-weight: bold;
            }
            .digit-count {
                font-size: 12px;
                color: #666;
                display: block;
                text-align: center;
            }
            .footer {
                text-align: center;
                margin-top: 20px;
                font-size: 12px;
                color: #666;
                padding: 10px;
                border-top: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>An√°lise de D√≠gitos do Dia de Sorte</h1>
            
            <div class="section">
                <h2>Estat√≠sticas de Frequ√™ncia dos D√≠gitos</h2>
                <div style="display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
    `;
    
    // Adicionar estat√≠sticas de d√≠gitos
    const sortedDigits = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
    sortedDigits.forEach(([digit, count]) => {
        htmlContent += `
            <div class="digit-box">${digit}
                <span class="digit-count">${count} vezes</span>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
                
                <h3>Gr√°fico de Frequ√™ncia</h3>
                <div style="padding: 15px;">
    `;
    
    // Adicionar gr√°fico de barras simples
    const maxCount = Math.max(...Object.values(digitStats));
    sortedDigits.forEach(([digit, count]) => {
        const percentage = (count / maxCount) * 100;
        htmlContent += `
            <div style="margin: 10px 0; display: flex; align-items: center;">
                <div style="width: 30px; text-align: center; font-weight: bold;">${digit}</div>
                <div style="flex-grow: 1; margin: 0 10px;">
                    <div style="background-color: #4CAF50; height: 24px; width: ${percentage}%;"></div>
                </div>
                <div style="width: 60px; text-align: right;">${count}</div>
            </div>
        `;
    });
    
    htmlContent += `
                </div>
            </div>
            
            <div class="section">
                <h2>Resumo por Quantidade de D√≠gitos</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Qtd. D√≠gitos</th>
                            <th>N√∫mero de Sorteios</th>
                            <th>Porcentagem</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resumo por quantidade de d√≠gitos
    const qtdKeys = Object.keys(combinationStats.porQuantidade)
        .sort((a, b) => parseInt(a) - parseInt(b));
    
    qtdKeys.forEach(qtd => {
        const count = combinationStats.porQuantidade[qtd].length;
        const percentage = ((count / allResults.length) * 100).toFixed(2);
        htmlContent += `
            <tr>
                <td>${qtd}</td>
                <td>${count}</td>
                <td>${percentage}%</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Combina√ß√µes Mais Frequentes</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Combina√ß√£o</th>
                            <th>Qtd. D√≠gitos</th>
                            <th>Frequ√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar combina√ß√µes mais frequentes
    combinationStats.combinacoesFrequentes.slice(0, 10).forEach(combo => {
        htmlContent += `
            <tr>
                <td>${combo.digitos.join(',')}</td>
                <td>${combo.quantidade}</td>
                <td>${combo.concursos.length}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Resultados Detalhados</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Concurso</th>
                            <th>Data</th>
                            <th>Dezenas</th>
                            <th>D√≠gitos</th>
                            <th>D√≠gitos Ordenados</th>
                            <th>Qtd. D√≠gitos</th>
                        </tr>
                    </thead>
                    <tbody>
    `;
    
    // Adicionar resultados detalhados
    filteredResults.forEach(result => {
        htmlContent += `
            <tr>
                <td>${result.concurso}</td>
                <td>${result.data || ''}</td>
                <td>${result.dezenas.join(' - ')}</td>
                <td>${result.digitos_para_exibicao || result.digitos.join(' ')}</td>
                <td>${result.digitos_ordenados.join(',')}</td>
                <td>${result.contagem_digitos}</td>
            </tr>
        `;
    });
    
    htmlContent += `
                    </tbody>
                </table>
            </div>
            
            <div class="footer">
                <p>Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}</p>
                <p>Total de resultados analisados: ${allResults.length}</p>
            </div>
        </div>
    </body>
    </html>
    `;
    
    // Criar o blob com tipo MIME para HTML
    const blob = new Blob([htmlContent], {type: 'text/html;charset=utf-8'});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = 'analise_digitos_diadesorte.html';
    link.click();
}    
    function downloadTXT() {
        if (allResults.length === 0) {
            alert('Carregue os resultados primeiro!');
            return;
        }
        
        let txtContent = "An√°lise de D√≠gitos do Dia de Sorte\n\n";
        
        // Adicionar estat√≠sticas - ordenar por frequ√™ncia para o arquivo TXT tamb√©m
        txtContent += "ESTAT√çSTICAS DE FREQU√äNCIA DOS D√çGITOS (ORDEM DECRESCENTE):\n";
        const sortedStats = Object.entries(digitStats).sort((a, b) => b[1] - a[1]);
        sortedStats.forEach(([digit, count]) => {
            txtContent += `D√≠gito ${digit}: ${count} ocorr√™ncias\n`;
        });
        
        // Adicionar resumo de combina√ß√µes
        txtContent += "\n\nRESUMO POR QUANTIDADE DE D√çGITOS:\n";
        const qtdKeys = Object.keys(combinationStats.porQuantidade)
            .sort((a, b) => parseInt(a) - parseInt(b));
        
        qtdKeys.forEach(qtd => {
            const count = combinationStats.porQuantidade[qtd].length;
            const percentage = ((count / allResults.length) * 100).toFixed(2);
            txtContent += `${qtd} d√≠gitos: ${count} sorteios (${percentage}%)\n`;
        });
        
        // Adicionar combina√ß√µes mais frequentes
        txtContent += "\n\nCOMBINA√á√ïES MAIS FREQUENTES:\n";
        combinationStats.combinacoesFrequentes.slice(0, 5).forEach((combo, index) => {
            txtContent += `${index + 1}. Combina√ß√£o [${combo.digitos.join(',')}]: Aparece em ${combo.concursos.length} sorteios\n`;
        });
        
        txtContent += "\n\nRESULTADOS DETALHADOS:\n";
        filteredResults.forEach(result => {
            const digitos = result.digitos_para_exibicao || result.digitos.join(' ');
            const digitosOrdenados = result.digitos_ordenados.join(',');
            txtContent += `Concurso: ${result.concurso} | Data: ${result.data} | Dezenas: ${result.dezenas.join('-')} | `;
            txtContent += `D√≠gitos: ${digitos} | Ordenados: ${digitosOrdenados} | `;
            txtContent += `Quantidade: ${result.contagem_digitos}\n`;
        });
        
        // Criar o blob com tipo MIME para texto
        const blob = new Blob([txtContent], {type: 'text/plain;charset=utf-8'});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = 'analise_digitos_diadesorte.txt';
        link.click();
    }
	
	// Fun√ß√£o auxiliar para download de arquivos
	function downloadFile(content, fileName, type) {
    const blob = new Blob([content], { type });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    link.click();
    console.log("Download iniciado:", fileName);
	}
	
});

/* 
 * CSS para tornar tabelas responsivas com barra de rolagem horizontal 
 * Adicione este c√≥digo ao seu arquivo styles.css existente
 */

/* Estilo para containers de tabelas responsivas */
.table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 100%;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}


/* Indicadores visuais de rolagem horizontal */
.table-responsive::after {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 5px;
    background: linear-gradient(to right, transparent, rgba(76, 175, 80, 0.3));
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
}

.table-responsive:hover::after {
    opacity: 1;
}

/* Estilos espec√≠ficos para cada tabela */
#megaSenaResults, 
.combinations-table, 
.summary-table, 
.frequency-table {
    width: 100%;
    border-collapse: collapse;
}

/* Ajustes para o container do resumo em telas pequenas */
@media screen and (max-width: 768px) {
    #resumo {
        padding: 15px;
    }
    
    #resumo h2 {
        font-size: 1.2rem;
    }
    
    #resumo p,
    #resumo li {
        font-size: 0.9rem;
    }
}

/* Fix para bot√µes em telas pequenas */
@media screen and (max-width: 480px) {
    .button {
        padding: 8px 12px;
        font-size: 14px;
        margin: 5px;
    }
    
    .actions {
        flex-wrap: wrap;
        justify-content: center;
    }
}
/* Ajustes para tornar tabelas mais compactas em telas pequenas 
@media screen and (max-width: 768px) {
    .table-responsive table {
        min-width: 650px; /* Garante que a tabela tenha um tamanho m√≠nimo para necessitar rolagem 
    }
    
    .table-responsive th,
    .table-responsive td {
        padding: 8px 5px;
        font-size: clamp(10px, 2vw, 12px);
    }
    
    .table-responsive th {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: #4CAF50;
    }
}
*/
/* Para telas menores que 1024px (tablets e laptops pequenos) */
@media screen and (max-width: 1024px) {
    .table-responsive table {
        min-width: 700px;
    }

    .table-responsive th,
    .table-responsive td {
        padding: 10px 6px;
        font-size: clamp(11px, 2vw, 14px);
    }

    .table-responsive th {
        background-color: #45A049;
    }
}

/* Para telas menores que 768px (tablets e celulares grandes) */
@media screen and (max-width: 768px) {
    .table-responsive table {
        min-width: 650px;
    }

    .table-responsive th,
    .table-responsive td {
        padding: 8px 5px;
        font-size: clamp(10px, 2vw, 12px);
    }

    .table-responsive th {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: #4CAF50;
    }
}

/* Para telas menores que 480px (celulares pequenos) */
@media screen and (max-width: 480px) {
    .table-responsive table {
        min-width: 600px;
    }

    .table-responsive th,
    .table-responsive td {
        padding: 6px 4px;
        font-size: clamp(9px, 2vw, 11px);
    }

    .table-responsive th {
        background-color: #3E8E41;
    }
}

/* Para telas menores que 360px (celulares muito pequenos) */
@media screen and (max-width: 360px) {
    .table-responsive table {
        min-width: 550px;
    }

    .table-responsive th,
    .table-responsive td {
        padding: 5px 3px;
        font-size: clamp(8px, 2vw, 10px);
    }

    .table-responsive th {
        background-color: #2E7D32;
    }
}

import os
from flask import Flask
from flask_cors import CORS
from dotenv import load_dotenv

load_dotenv()  # Carregar vari√É¬°veis de ambiente do arquivo .env

app = Flask(__name__, 
            static_folder='../static',
            template_folder='../templates')
CORS(app)

from app import routes

from flask import render_template, jsonify, request
from app import app
import requests
import redis
import os
import json
import logging

#API_BASE_URL = os.getenv('API_BASE_URL', 'https://loteriascaixa-api.herokuapp.com/api')

# Configurar logging
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# Configura√ß√µes do Redis
REDIS_HOST = os.getenv('REDIS_HOST')
REDIS_PORT = os.getenv('REDIS_PORT')
REDIS_PASSWORD = os.getenv('REDIS_PASSWORD')
REDIS_DB = os.getenv('REDIS_DB', '0')
API_BASE_URL = os.getenv('API_BASE_URL')

logger.info(f"Configura√ß√µes carregadas: HOST={REDIS_HOST}, PORT={REDIS_PORT}, API={API_BASE_URL}")

# Conex√£o com o Redis
try:
    redis_client = redis.Redis(
        host=REDIS_HOST,
        port=int(REDIS_PORT),
        password=REDIS_PASSWORD,
        db=int(REDIS_DB),
        decode_responses=True
    )
    # Teste da conex√£o
    redis_client.ping()
    logger.info("Conex√£o com Redis estabelecida com sucesso")
except Exception as e:
    logger.error(f"Erro ao conectar ao Redis: {str(e)}")
    # Criar um mock do redis em mem√≥ria para n√£o quebrar a aplica√ß√£o
    class MockRedis:
        def __init__(self):
            self.data = {}
        
        def get(self, key):
            return self.data.get(key)
        
        def set(self, key, value, ex=None):
            self.data[key] = value
            return True
        
        def ping(self):
            return True
    
    redis_client = MockRedis()
    logger.warning("Usando Redis em mem√≥ria (mock)")

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/resultados')
def get_resultados():
    cache_key = 'diadesorte:resultados'
    
    # Verifica se os dados est√£o em cache
    try:
        cached_data = redis_client.get(cache_key)
        if cached_data:
            logger.info("Usando dados do cache para resultados")
            return jsonify(json.loads(cached_data))
    except Exception as e:
        logger.error(f"Erro ao acessar cache: {str(e)}")
    
    # Se n√£o estiver em cache, busca na API
    try:
        logger.info(f"Buscando dados na API: {API_BASE_URL}/diadesorte")
        response = requests.get(f"{API_BASE_URL}/diadesorte")
        if response.status_code == 200:
            data = response.json()
            logger.info(f"Dados recebidos da API: {len(data)} registros")
            # Salva no Redis por 1 hora (3600 segundos)
            try:
                redis_client.set(cache_key, json.dumps(data), ex=3600)
            except Exception as e:
                logger.error(f"Erro ao salvar no cache: {str(e)}")
            return jsonify(data)
        else:
            logger.error(f"Erro ao acessar API: {response.status_code}")
            return jsonify({"error": f"Erro ao acessar a API: {response.status_code}"}), 500
    except Exception as e:
        logger.error(f"Exce√ß√£o ao buscar dados: {str(e)}")
        return jsonify({"error": str(e)}), 500

@app.route('/api/digitos')
def get_digitos():
    cache_key = 'diadesorte:digitos'
    
    # Log para debug
    logger.info("Rota /api/digitos acessada")
    
    # Verifica se os dados est√£o em cache
    try:
        cached_data = redis_client.get(cache_key)
        if cached_data:
            logger.info("Usando dados do cache para d√≠gitos")
            return jsonify(json.loads(cached_data))
    except Exception as e:
        logger.error(f"Erro ao acessar cache: {str(e)}")
    
    # Se n√£o estiver em cache, processa os dados
    try:
        logger.info(f"Buscando dados na API: {API_BASE_URL}/diadesorte")
        response = requests.get(f"{API_BASE_URL}/diadesorte")
        if response.status_code == 200:
            data = response.json()
            logger.info(f"Dados recebidos da API: {len(data)} registros")
            
            # Processar os d√≠gitos
            resultados_processados = []
            frequencia_digitos = {str(i): 0 for i in range(10)}
            
            for concurso in data:
                dezenas = concurso.get('dezenas', [])
                
                # Extrair d√≠gitos √∫nicos das dezenas
                digitos_unicos_set = set()
                for dezena in dezenas:
                    for digito in dezena:
                        digitos_unicos_set.add(digito)
                        frequencia_digitos[digito] += 1
                
                # Converter para lista e ordenar (ordem decrescente para exibi√ß√£o)
                digitos_unicos = sorted(list(digitos_unicos_set), reverse=True)
                
                # Ordenar d√≠gitos para facilitar c√≥pia (ordem crescente)
                digitos_ordenados = sorted(list(digitos_unicos_set))
                
                resultados_processados.append({
                    'concurso': concurso.get('concurso'),
                    'data': concurso.get('data'),
                    'dezenas': dezenas,
                    'digitos': digitos_unicos,  # D√≠gitos sem repeti√ß√£o, em ordem decrescente
                    'digitos_ordenados': digitos_ordenados,  # D√≠gitos sem repeti√ß√£o, em ordem crescente
                    'digitos_para_copia': ','.join(digitos_ordenados),  # Com v√≠rgulas para facilitar c√≥pia
                    'digitos_para_exibicao': ' '.join(digitos_unicos),  # Com espa√ßos para exibi√ß√£o
                    'contagem_digitos': len(digitos_unicos_set)  # Quantidade de d√≠gitos √∫nicos
                })
            
            # Ordenar frequ√™ncia de d√≠gitos
            frequencia_ordenada = {k: v for k, v in sorted(frequencia_digitos.items(), key=lambda item: item[1], reverse=True)}
            
            resultado_final = {
                'resultados': resultados_processados,
                'frequencia_digitos': frequencia_ordenada
            }
            
            # Salva no Redis por 1 hora (3600 segundos)
            try:
                redis_client.set(cache_key, json.dumps(resultado_final), ex=3600)
            except Exception as e:
                logger.error(f"Erro ao salvar no cache: {str(e)}")
                
            logger.info("Processamento de d√≠gitos conclu√≠do com sucesso")
            return jsonify(resultado_final)
        else:
            logger.error(f"Erro ao acessar API: {response.status_code}")
            return jsonify({"error": f"Erro ao acessar a API: {response.status_code}"}), 500
    except Exception as e:
        logger.error(f"Exce√ß√£o ao processar dados: {str(e)}")
        return jsonify({"error": str(e)}), 500



